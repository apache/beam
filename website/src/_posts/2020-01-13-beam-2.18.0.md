---
layout: post
title:  "Apache Beam 2.18.0"
date:   2020-01-13 00:00:01 -0800
# Date above corrected but keep the old URL:
permalink: /blog/2020/01/13/beam-2.18.0.html
excerpt_separator: <!--more-->
categories: blog
authors:
  - udim

---
<!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

We are happy to present the new 2.18.0 release of Beam. This release includes both improvements and new functionality.
See the [download page]({{ site.baseurl }}/get-started/downloads/#2180-2020-01-TODO) for this release.<!--more-->
For more information on changes in 2.18.0, check out the
[detailed release notes](https://issues.apache.org/jira/secure/ReleaseNote.jspa?version=12346383&projectId=12319527).

## Highlights

 * New highly anticipated feature X added to Python SDK ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).
 * New highly anticipated feature Y added to JavaSDK ([BEAM-Y](https://issues.apache.org/jira/browse/BEAM-Y)).

{$TOPICS e.g.:}
### I/Os
* Support for X source added (Java) ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).
{$TOPICS}

### New Features / Improvements

* X feature added (Python) ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).
* Y feature added (Java) [BEAM-Y](https://issues.apache.org/jira/browse/BEAM-Y).

### Breaking Changes

* X behavior was changed ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).
* Y behavior was changed ([BEAM-Y](https://issues.apache.org/jira/browse/BEAM-X)).

### Deprecations

* X behavior is deprecated and will be removed in X versions ([BEAM-X](https://issues.apache.org/jira/browse/BEAM-X)).

### Bugfixes

* Fixed X (Python) ([BEAM-Y](https://issues.apache.org/jira/browse/BEAM-X)).
* Fixed Y (Java) ([BEAM-Y](https://issues.apache.org/jira/browse/BEAM-Y)).


    TODO: sort these

- Sub-task
    * [BEAM-3658](https://issues.apache.org/jira/browse/BEAM-3658) - Port SpannerIOReadTest off DoFnTester
    * [BEAM-5878](https://issues.apache.org/jira/browse/BEAM-5878) - Support DoFns with Keyword-only arguments in Python 3.
    * [BEAM-6756](https://issues.apache.org/jira/browse/BEAM-6756) - Support lazy iterables in schemas
    * [BEAM-7078](https://issues.apache.org/jira/browse/BEAM-7078) - Beam Dependency Update Request: com.amazonaws:amazon-kinesis-client
    * [BEAM-7636](https://issues.apache.org/jira/browse/BEAM-7636) - Migrate SqsIO to AWS SDK for Java 2
    * [BEAM-7948](https://issues.apache.org/jira/browse/BEAM-7948) - Add time-based cache threshold support in the Java data service
    * [BEAM-7952](https://issues.apache.org/jira/browse/BEAM-7952) - Make the input queue of the input buffer in Python SDK Harness size limited.
    * [BEAM-8252](https://issues.apache.org/jira/browse/BEAM-8252) - (Python SDK) Add worker_region and worker_zone options
    * [BEAM-8254](https://issues.apache.org/jira/browse/BEAM-8254) - (Java SDK) Add workerRegion and workerZone options
    * [BEAM-8442](https://issues.apache.org/jira/browse/BEAM-8442) - Unify bundle register in Python SDK harness
    * [BEAM-8557](https://issues.apache.org/jira/browse/BEAM-8557) - Clean up useless null check.


- Bug
    * [BEAM-3493](https://issues.apache.org/jira/browse/BEAM-3493) - Prevent users from "implementing" PipelineOptions
    * [BEAM-4776](https://issues.apache.org/jira/browse/BEAM-4776) - Java PortableRunner should support metrics
    * [BEAM-4777](https://issues.apache.org/jira/browse/BEAM-4777) - Python PortableRunner should support metrics
    * [BEAM-7917](https://issues.apache.org/jira/browse/BEAM-7917) - Python datastore v1new fails on retry
    * [BEAM-7981](https://issues.apache.org/jira/browse/BEAM-7981) - ParDo function wrapper doesn't support Iterable output types
    * [BEAM-8146](https://issues.apache.org/jira/browse/BEAM-8146) - SchemaCoder/RowCoder have no equals() function
    * [BEAM-8204](https://issues.apache.org/jira/browse/BEAM-8204) - ParDoTest.testSideInputAnnotationWithMultipleSideInputs & AvroSchemaTest failed on ApexRunner
    * [BEAM-8205](https://issues.apache.org/jira/browse/BEAM-8205) - AvroSchemaTest failed on FlinkRunner
    * [BEAM-8347](https://issues.apache.org/jira/browse/BEAM-8347) - UnboundedRabbitMqReader can fail to advance watermark if no new data comes in
    * [BEAM-8352](https://issues.apache.org/jira/browse/BEAM-8352) - Reading records in background may lead to OOM errors
    * [BEAM-8450](https://issues.apache.org/jira/browse/BEAM-8450) - ParDoLifecycleTest does not allow for empty bundles
    * [BEAM-8451](https://issues.apache.org/jira/browse/BEAM-8451) - Interactive Beam example failing from stack overflow
    * [BEAM-8480](https://issues.apache.org/jira/browse/BEAM-8480) - Explicitly set restriction coder for bounded reader wrapper SDF.
    * [BEAM-8515](https://issues.apache.org/jira/browse/BEAM-8515) - Ensure that ValueProvider types have equals/hashCode implemented for comparison reasons
    * [BEAM-8517](https://issues.apache.org/jira/browse/BEAM-8517) - Jdbc Schema timestamp conversion has timezone inconsistency issue in test
    * [BEAM-8518](https://issues.apache.org/jira/browse/BEAM-8518) - Pipeline options translation fails silently with incompatible jackson-core library
    * [BEAM-8521](https://issues.apache.org/jira/browse/BEAM-8521) - beam_PostCommit_XVR_Flink failing
    * [BEAM-8530](https://issues.apache.org/jira/browse/BEAM-8530) - Dataflow portable runner fails timer ordering tests
    * [BEAM-8565](https://issues.apache.org/jira/browse/BEAM-8565) - Update .test-infra/jenkins/README with missing entries and correct wrong entries
    * [BEAM-8574](https://issues.apache.org/jira/browse/BEAM-8574) - [SQL] MongoDb PostCommit_SQL fails
    * [BEAM-8579](https://issues.apache.org/jira/browse/BEAM-8579) - Strip UTF-8 BOM bytes (if present) in TextSource.
    * [BEAM-8621](https://issues.apache.org/jira/browse/BEAM-8621) - [Java] beam_Dependency_Check reads smaller number of dependencies than expected
    * [BEAM-8657](https://issues.apache.org/jira/browse/BEAM-8657) - Not doing Combiner lifting for data-driven triggers
    * [BEAM-8663](https://issues.apache.org/jira/browse/BEAM-8663) - BundleBasedRunner Stacked Bundles don't respect PaneInfo
    * [BEAM-8667](https://issues.apache.org/jira/browse/BEAM-8667) - Data channel should to avoid unlimited buffering in Python SDK
    * [BEAM-8733](https://issues.apache.org/jira/browse/BEAM-8733) - The "KeyError: u'-47'" error from line 305 of sdk_worker.py
    * [BEAM-8740](https://issues.apache.org/jira/browse/BEAM-8740) - TestPubsub ignores timeout
    * [BEAM-8747](https://issues.apache.org/jira/browse/BEAM-8747) - Remove Unused non-vendored Guava compile dependencies
    * [BEAM-8802](https://issues.apache.org/jira/browse/BEAM-8802) - Timestamp combiner not respected across bundles in streaming mode.
    * [BEAM-8803](https://issues.apache.org/jira/browse/BEAM-8803) - Default behaviour for Python BQ Streaming inserts sink should be to retry always
    * [BEAM-8814](https://issues.apache.org/jira/browse/BEAM-8814) - --no_auth flag is boolean type and is misleading
    * [BEAM-8822](https://issues.apache.org/jira/browse/BEAM-8822) - Upgrade Hadoop dependencies to version 2.8
    * [BEAM-8825](https://issues.apache.org/jira/browse/BEAM-8825) - OOM when writing large numbers of 'narrow' rows
    * [BEAM-8835](https://issues.apache.org/jira/browse/BEAM-8835) - Artifact retrieval fails with FlinkUberJarJobServer
    * [BEAM-8836](https://issues.apache.org/jira/browse/BEAM-8836) - ExternalTransform is not providing a unique name
    * [BEAM-8882](https://issues.apache.org/jira/browse/BEAM-8882) - Allow Dataflow to automatically choose portability or not.
    * [BEAM-8884](https://issues.apache.org/jira/browse/BEAM-8884) - Python MongoDBIO TypeError when splitting
    * [BEAM-8944](https://issues.apache.org/jira/browse/BEAM-8944) - Python SDK harness performance degradation with UnboundedThreadPoolExecutor
    * [BEAM-8974](https://issues.apache.org/jira/browse/BEAM-8974) - apache_beam.runners.worker.log_handler_test.FnApiLogRecordHandlerTest.test_exc_info is flaky
    * [BEAM-9041](https://issues.apache.org/jira/browse/BEAM-9041) - SchemaCoder equals should not rely on from/toRowFunction equality
    * [BEAM-9042](https://issues.apache.org/jira/browse/BEAM-9042) - AvroUtils.schemaCoder(schema) produces a not serializable SchemaCoder
    * [BEAM-9065](https://issues.apache.org/jira/browse/BEAM-9065) - Spark runner accumulates metrics (incorrectly) between runs


- New Feature
    * [BEAM-7760](https://issues.apache.org/jira/browse/BEAM-7760) - Interactive Beam Caching PCollections bound to user defined vars in notebook
    * [BEAM-8343](https://issues.apache.org/jira/browse/BEAM-8343) - Add means for IO APIs to support predicate and/or project push-down when running SQL pipelines
    * [BEAM-8365](https://issues.apache.org/jira/browse/BEAM-8365) - Add project push-down capability to IO APIs
    * [BEAM-8379](https://issues.apache.org/jira/browse/BEAM-8379) - Cache Eviction for Interactive Beam
    * [BEAM-8383](https://issues.apache.org/jira/browse/BEAM-8383) - Add metrics to Python state cache
    * [BEAM-8427](https://issues.apache.org/jira/browse/BEAM-8427) - [SQL] Add support for MongoDB source
    * [BEAM-8468](https://issues.apache.org/jira/browse/BEAM-8468) - Add predicate/filter push-down capability to IO APIs
    * [BEAM-8523](https://issues.apache.org/jira/browse/BEAM-8523) - Add useful timestamp to job servicer GetJobs

- Improvement
    * [BEAM-6303](https://issues.apache.org/jira/browse/BEAM-6303) - Add .parquet extension to files in ParquetIO
    * [BEAM-8016](https://issues.apache.org/jira/browse/BEAM-8016) - Render Beam Pipeline as DOT with Interactive Beam  
    * [BEAM-8151](https://issues.apache.org/jira/browse/BEAM-8151) - Allow the Python SDK to use many many threads
    * [BEAM-8337](https://issues.apache.org/jira/browse/BEAM-8337) - Add Flink job server container images to release process
    * [BEAM-8428](https://issues.apache.org/jira/browse/BEAM-8428) - [SQL] BigQuery should support project push-down in DIRECT_READ mode
    * [BEAM-8434](https://issues.apache.org/jira/browse/BEAM-8434) - Allow trigger transcript tests to be run as ValidatesRunner tests. 
    * [BEAM-8456](https://issues.apache.org/jira/browse/BEAM-8456) - Add pipeline option to control truncate of BigQuery data processed by Beam SQL
    * [BEAM-8457](https://issues.apache.org/jira/browse/BEAM-8457) - Instrument Dataflow jobs that are launched from Notebooks
    * [BEAM-8470](https://issues.apache.org/jira/browse/BEAM-8470) - Create a new Spark runner based on Spark Structured streaming framework
    * [BEAM-8503](https://issues.apache.org/jira/browse/BEAM-8503) - Improve TestBigQuery and TestPubsub
    * [BEAM-8508](https://issues.apache.org/jira/browse/BEAM-8508) - [SQL] Support predicate push-down without project push-down
    * [BEAM-8509](https://issues.apache.org/jira/browse/BEAM-8509) - TestPortableRunner should use JobServerDriver interface
    * [BEAM-8513](https://issues.apache.org/jira/browse/BEAM-8513) - RabbitMqIO: Allow reads from exchange-bound queue without declaring the exchange
    * [BEAM-8516](https://issues.apache.org/jira/browse/BEAM-8516) - sdist build fails when artifacts from different versions are present
    * [BEAM-8524](https://issues.apache.org/jira/browse/BEAM-8524) - Stop using pubsub in fnapi streaming dataflow Impluse
    * [BEAM-8540](https://issues.apache.org/jira/browse/BEAM-8540) - Fix CSVSink example in FileIO docs
    * [BEAM-8570](https://issues.apache.org/jira/browse/BEAM-8570) - Use SDK version in default Java container tag
    * [BEAM-8573](https://issues.apache.org/jira/browse/BEAM-8573) - @SplitRestriction's documented signature is incorrect
    * [BEAM-8583](https://issues.apache.org/jira/browse/BEAM-8583) - [SQL] BigQuery should support predicate push-down in DIRECT_READ mode
    * [BEAM-8585](https://issues.apache.org/jira/browse/BEAM-8585) - Include path in error message in path_to_beam_jar
    * [BEAM-8594](https://issues.apache.org/jira/browse/BEAM-8594) - Remove unnecessary error check of the control service accessing in DataFlow Runner
    * [BEAM-8597](https://issues.apache.org/jira/browse/BEAM-8597) - Allow TestStream trigger tests to run on other runners.
    * [BEAM-8617](https://issues.apache.org/jira/browse/BEAM-8617) - Tear down the DoFns upon the control service termination in Python SDK harness
    * [BEAM-8619](https://issues.apache.org/jira/browse/BEAM-8619) - Tear down the DoFns upon the control service termination in Java SDK harness
    * [BEAM-8658](https://issues.apache.org/jira/browse/BEAM-8658) - Optionally set artifact staging port in FlinkUberJarJobServer
    * [BEAM-8659](https://issues.apache.org/jira/browse/BEAM-8659) - RowJsonTest should test serialization independently
    * [BEAM-8660](https://issues.apache.org/jira/browse/BEAM-8660) - Override returned artifact staging endpoint
    * [BEAM-8664](https://issues.apache.org/jira/browse/BEAM-8664) - [SQL] MongoDb should use project push-down
    * [BEAM-8666](https://issues.apache.org/jira/browse/BEAM-8666) - Remove dependency between DataflowRunner and PortableRunner introduced by PR#9811
    * [BEAM-8743](https://issues.apache.org/jira/browse/BEAM-8743) - Add support for flat schemas in pubsub
    * [BEAM-8781](https://issues.apache.org/jira/browse/BEAM-8781) - FlinkUberJarJobServer should respect --flink_job_server_jar
    * [BEAM-8794](https://issues.apache.org/jira/browse/BEAM-8794) - Projects should be handled by an IOPushDownRule before applying AggregateProjectMergeRule
    * [BEAM-8796](https://issues.apache.org/jira/browse/BEAM-8796) - Optionally configure static job port for JavaJarJobServer
    * [BEAM-8805](https://issues.apache.org/jira/browse/BEAM-8805) - Remove obsolete worker_threads experiment in tests
    * [BEAM-8883](https://issues.apache.org/jira/browse/BEAM-8883) - downgrade "Failed to remove job staging directory" log level
    * [BEAM-8902](https://issues.apache.org/jira/browse/BEAM-8902) - parameterize input type of Java external transform
    * [BEAM-8903](https://issues.apache.org/jira/browse/BEAM-8903) - handling --jar_packages experimental flag in PortableRunner for staging external dependencies used in expanded transforms
    * [BEAM-8904](https://issues.apache.org/jira/browse/BEAM-8904) - properly update output pcollections from expanded transforms
    * [BEAM-8905](https://issues.apache.org/jira/browse/BEAM-8905) - matching Java PCollectionTuple translation naming convention in expansion service with index only
    * [BEAM-8976](https://issues.apache.org/jira/browse/BEAM-8976) - No default logging story for Pipeline construction time in Python

- Test
    * [BEAM-8028](https://issues.apache.org/jira/browse/BEAM-8028) - Simplify running of Beam Python on Spark
    * [BEAM-8586](https://issues.apache.org/jira/browse/BEAM-8586) - [SQL] Add a server for MongoDb Integration Test


- Task
    * [BEAM-3288](https://issues.apache.org/jira/browse/BEAM-3288) - Guard against unsafe triggers at construction time 
    * [BEAM-8398](https://issues.apache.org/jira/browse/BEAM-8398) - Upgrade Dataflow Java Client API
    * [BEAM-8670](https://issues.apache.org/jira/browse/BEAM-8670) - Manage environment parallelism in DefaultJobBundleFactory


### Known Issues

* Python: `beam.Create` no longer preserves order unless `reshuffle=False` is passed in as an argument.
[BEAM-8882](https://issues.apache.org/jira/browse/BEAM-8882)(https://issues.apache.org/jira/browse/BEAM-8882)

  You may encounter this issue when using DirectRunner. 
* See a full list of open [issues that affect](https://issues.apache.org/jira/issues/?jql=project%20%3D%20BEAM%20AND%20affectedVersion%20%3D%202.18.0%20ORDER%20BY%20priority%20DESC%2C%20updated%20DESC) this version.


## List of Contributors

According to git shortlog, the following people contributed to the 2.18.0 release. Thank you to all contributors!

Ahmet Altay, Alex Amato, Alexey Romanenko, Andrew Pilloud, Ankur Goenka, Anton Kedin, Boyuan Zhang, Brian Hulette, Brian Martin, Chamikara Jayalath, Charles Chen, Craig Chambers, Daniel Oliveira, David Moravek, David Rieber, Dustin Rhodes, Etienne Chauchot, Gleb Kanterov, Hai Lu, Heejong Lee, Ismaël Mejía, Jan Lukavský, Jason Kuster, Jean-Baptiste Onofré, Jeff Klukas, João Cabrita, J Ross Thomson, Juan Rael, Juta, Kasia Kucharczyk, Kengo Seki, Kenneth Jung, Kenneth Knowles, Kyle Weaver, Kyle Winkelman, Lukas Drbal, Łukasz Gajowy, Marek Simunek, Mark Liu, Maximilian Michels, Melissa Pashniak, Michael Luckey, Michal Walenia, Mike Pedersen, Mikhail Gryzykhin, Niel Markwick, Pablo Estrada, Pascal Gula, Reuven Lax, Rob, Robbe Sneyders, Robert Bradshaw, Robert Burke, Rui Wang, Ruoyun Huang, Ryan Williams, Sam Rohde, Sam Whittle, Scott Wegner, Thomas Weise, Tianyang Hu, ttanay, tvalentyn, Tyler Akidau, Udi Meiri, Valentyn Tymofieiev, Xinyu Liu, XuMingmin
