<!DOCTYPE html>
<!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<html lang="en">
  <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Portability Framework</title>
  <meta name="description" content="Apache Beam is an open source, unified model and set of language-specific SDKs for defining and executing data processing workflows, and also data ingestion and integration flows, supporting Enterprise Integration Patterns (EIPs) and Domain Specific Languages (DSLs). Dataflow pipelines simplify the mechanics of large-scale batch and streaming data processing and can run on a number of runtimes like Apache Flink, Apache Spark, and Google Cloud Dataflow (a cloud service). Beam also brings DSL in different languages, allowing users to easily implement their data integration processes.
">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">
  <link rel="stylesheet" href="/css/site.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/language-switch.js"></script>
  <script src="/js/fix-menu.js"></script>
  <script src="/js/section-nav.js"></script>
  <script src="/js/page-nav.js"></script>
  <link rel="canonical" href="https://beam.apache.org/contribute/portability/" data-proofer-ignore>
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Apache Beam" href="https://beam.apache.org/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-73650088-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body class="body" data-spy="scroll" data-target=".page-nav" data-offset="0">
    <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<nav class="header navbar navbar-fixed-top">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/" class="navbar-brand" >
        <img alt="Brand" style="height: 25px" src="/images/beam_logo_navbar.png">
      </a>
    </div>

    <div class="navbar-mask closed"></div>

    <div id="navbar" class="navbar-container closed">
      <ul class="nav navbar-nav">
        <li>
          <a href="/get-started/beam-overview/">Get Started</a>
        </li>
        <li>
          <a href="/documentation/">Documentation</a>
        </li>
        <li>
          <a href="/documentation/sdks/java/">SDKS</a>
        </li>
        <li>
          <a href="/documentation/runners/capability-matrix/">RUNNERS</a>
        </li>
        <li>
          <a href="/contribute/">Contribute</a>
        </li>
        <li>
          <a href="/community/contact-us/">Community</a>
        </li>
        <li><a href="/blog">Blog</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="https://www.apache.org/foundation/press/kit/feather_small.png" alt="Apache Logo" style="height:20px;"><span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="http://www.apache.org/">ASF Homepage</a></li>
            <li><a href="http://www.apache.org/licenses/">License</a></li>
            <li><a href="http://www.apache.org/security/">Security</a></li>
            <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
          </ul>
        </li>
      </ul>
    </div>
</nav>

    <div class="clearfix container-main-content">
      <div class="section-nav closed" data-offset-top="90" data-offset-bottom="500">
        <span class="section-nav-back glyphicon glyphicon-menu-left"></span>
        <nav>
          <ul class="section-nav-list" data-section-nav>
            <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<li><span class="section-nav-list-main-title">Contribute</span></li>
<li><a href="/contribute/">Get started contributing</a></li>
<li>
  <span class="section-nav-list-title">IDE tips</span>

  <ul class="section-nav-list">
    <li><a href="https://cwiki.apache.org/confluence/display/BEAM/IntelliJ+Tips">IntelliJ Tips</a></li>
    <li><a href="https://cwiki.apache.org/confluence/display/BEAM/Eclipse+Tips">Eclipse Tips</a></li>
  </ul>
</li>
<li>
  <span class="section-nav-list-title">Technical Docs</span>

  <ul class="section-nav-list">
    <li><a href="/contribute/testing/">Testing guide</a></li>
    <ul>
      <li><a href="/contribute/precommit-triage-guide/">Pre-commit Slowness Triage Guide</a></li>
    </ul>
    <li><a href="/contribute/ptransform-style-guide/">PTransform style guide</a></li>
    <li><a href="/contribute/runner-guide/">Runner authoring guide</a></li>
    <li><a href="/contribute/portability/">Portability Framework</a></li>
    <li><a href="/contribute/docker-images/">Docker images</a></li>
    <li><a href="/contribute/design-documents/">Design documents</a></li>
    <li><a href="/contribute/dependencies/">Dependencies guide</a></li>
  </ul>
</li>
<li>
  <span class="section-nav-list-title">Policies</span>
  <ul class="section-nav-list">
    <li><a href="/contribute/precommit-policies/">Pre-commit test policies</a></li>
    <li><a href="/contribute/postcommits-policies/">Post-commit test policies</a></li>
  </ul>
</li>
<li>
  <span class="section-nav-list-title">Committers</span>

  <ul class="section-nav-list">
    <li><a href="/contribute/become-a-committer/">Become a committer</a></li>
    <li><a href="/contribute/committer-guide/">Committer guide</a></li>
    <li><a href="/contribute/release-guide/">Release guide</a></li>
  </ul>
</li>

          </ul>
        </nav>
      </div>

      <nav class="page-nav clearfix" data-offset-top="90" data-offset-bottom="500">
        <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->



<ul class="nav">
  <li><a href="#overview">Overview</a></li>
  <li><a href="#design">Design</a></li>
  <li><a href="#development">Development</a>
    <ul>
      <li><a href="#roadmap">Roadmap</a></li>
      <li><a href="#issues">Issues</a></li>
      <li><a href="#status">Status</a></li>
    </ul>
  </li>
</ul>


      </nav>

      <div class="body__contained body__section-nav">
        <!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<h1 id="portability-framework">Portability Framework</h1>

<ul id="markdown-toc">
  <li><a href="#overview" id="markdown-toc-overview">Overview</a></li>
  <li><a href="#design" id="markdown-toc-design">Design</a></li>
  <li><a href="#development" id="markdown-toc-development">Development</a>    <ul>
      <li><a href="#roadmap" id="markdown-toc-roadmap">Roadmap</a></li>
      <li><a href="#issues" id="markdown-toc-issues">Issues</a></li>
      <li><a href="#status" id="markdown-toc-status">Status</a>        <ul>
          <li><a href="#running-python-wordcount-on-flink" id="markdown-toc-running-python-wordcount-on-flink">Running Python wordcount on Flink</a></li>
        </ul>
      </li>
    </ul>
  </li>
</ul>

<h2 id="overview">Overview</h2>

<p>Interoperability between SDKs and runners is a key aspect of Apache
Beam. So far, however, the reality is that most runners support the
Java SDK only, because each SDK-runner combination requires non-trivial
work on both sides. All runners are also currently written in Java,
which makes support of non-Java SDKs far more expensive. The
<em>portability framework</em> aims to rectify this situation and provide
full interoperability across the Beam ecosystem.</p>

<p>The portability framework introduces well-defined, language-neutral
data structures and protocols between the SDK and runner. This interop
layer – called the <em>portability API</em> – ensures that SDKs and runners
can work with each other uniformly, reducing the interoperability
burden for both SDKs and runners to a constant effort.  It notably
ensures that <em>new</em> SDKs automatically work with existing runners and
vice versa.  The framework introduces a new runner, the <em>Universal
Local Runner (ULR)</em>, as a practical reference implementation that
complements the direct runners. Finally, it enables cross-language
pipelines (sharing I/O or transformations across SDKs) and
user-customized execution environments (“custom containers”).</p>

<p>The portability API consists of a set of smaller contracts that
isolate SDKs and runners for job submission, management and
execution. These contracts use protobufs and gRPC for broad language
support.</p>

<ul>
  <li>
    <p><strong>Job submission and management</strong>: The <em>Runner API</em> defines a
language-neutral pipeline representation with transformations
specifying the execution environment as a docker container
image. The latter both allows the execution side to set up the
right environment as well as opens the door for custom containers
and cross-environment pipelines. The <em>Job API</em> allows pipeline
execution and configuration to be managed uniformly.</p>
  </li>
  <li>
    <p><strong>Job execution</strong>: The <em>SDK harness</em> is a SDK-provided
program responsible for executing user code and is run separately
from the runner.  The <em>Fn API</em> defines an execution-time binary
contract between the SDK harness and the runner that describes how
execution tasks are managed and how data is transferred. In
addition, the runner needs to handle progress and monitoring in an
efficient and language-neutral way. SDK harness initialization
relies on the <em>Provision</em> and <em>Artifact APIs</em> for obtaining staged
files, pipeline options and environment information. Docker
provides isolation between the runner and SDK/user environments to
the benefit of both as defined by the <em>container contract</em>. The
containerization of the SDK gives it (and the user, unless the SDK
is closed) full control over its own environment without risk of
dependency conflicts. The runner has significant freedom regarding
how it manages the SDK harness containers.</p>
  </li>
</ul>

<p>The goal is that all (non-direct) runners and SDKs eventually support
the portability API, perhaps exclusively.</p>

<h2 id="design">Design</h2>

<p>The <a href="https://github.com/apache/beam/tree/master/model">model protos</a>
contain all aspects of the portability API and is the truth on the
ground. The proto definitions supercede any design documents. The main
design documents are the following:</p>

<ul>
  <li>
    <p><a href="https://s.apache.org/beam-runner-api">Runner API</a>. Pipeline
representation and discussion on primitive/composite transforms and
optimizations.</p>
  </li>
  <li>
    <p><a href="https://s.apache.org/beam-job-api">Job API</a>. Job submission and
management protocol.</p>
  </li>
  <li>
    <p><a href="https://s.apache.org/beam-fn-api">Fn API</a>. Execution-side control
and data protocols and overview.</p>
  </li>
  <li>
    <p><a href="https://s.apache.org/beam-fn-api-container-contract">Container
contract</a>.
Execution-side docker container invocation and provisioning
protocols. See
<a href="https://github.com/apache/beam/blob/master/sdks/CONTAINERS.md">CONTAINERS.md</a>
for how to build container images.</p>
  </li>
</ul>

<p>In discussion:</p>

<ul>
  <li><a href="https://s.apache.org/beam-mixed-language-pipelines">Cross
language</a>. Options
and tradeoffs for how to handle various kinds of
multi-language/multi-SDK pipelines.</li>
</ul>

<h2 id="development">Development</h2>

<p>The portability framework is a substantial effort that touches every
Beam component. In addition to the sheer magnitude, a major challenge
is engineering an interop layer that does not significantly compromise
performance due to the additional serialization overhead of a
language-neutral protocol.</p>

<h3 id="roadmap">Roadmap</h3>

<p>The proposed project phases are roughly as follows and are not
strictly sequential, as various components will likely move at
different speeds. Additionally, there have been (and continues to be)
supporting refactorings that are not always tracked as part of the
portability effort. Work already done is not tracked here either.</p>

<ul>
  <li>
    <p><strong>P1 [MVP]</strong>: Implement the fundamental plumbing for portable SDKs
and runners for batch and streaming, including containers and the
ULR
[<a href="https://issues.apache.org/jira/browse/BEAM-2899">BEAM-2899</a>]. Each
SDK and runner should use the portability framework at least to the
extent that wordcount
[<a href="https://issues.apache.org/jira/browse/BEAM-2896">BEAM-2896</a>] and
windowed wordcount
[<a href="https://issues.apache.org/jira/browse/BEAM-2941">BEAM-2941</a>] run
portably.</p>
  </li>
  <li>
    <p><strong>P2 [Feature complete]</strong>: Design and implement portability support
for remaining execution-side features, so that any pipeline from
any SDK can run portably on any runner. These features include side
inputs
[<a href="https://issues.apache.org/jira/browse/BEAM-2863">BEAM-2863</a>], User state [<a href="https://issues.apache.org/jira/browse/BEAM-2862">BEAM-2862</a>], User
timers
[<a href="https://issues.apache.org/jira/browse/BEAM-2925">BEAM-2925</a>],
Splittable DoFn
[<a href="https://issues.apache.org/jira/browse/BEAM-2896">BEAM-2896</a>] and
more.  Each SDK and runner should use the portability framework at
least to the extent that the mobile gaming examples
[<a href="https://issues.apache.org/jira/browse/BEAM-2940">BEAM-2940</a>] run
portably.</p>
  </li>
  <li>
    <p><strong>P3 [Performance]</strong>: Measure and tune performance of portable
pipelines using benchmarks such as Nexmark. Features such as
progress reporting
[<a href="https://issues.apache.org/jira/browse/BEAM-2940">BEAM-2940</a>],
combiner lifting
[<a href="https://issues.apache.org/jira/browse/BEAM-2937">BEAM-2937</a>] and
fusion are expected to be needed.</p>
  </li>
  <li>
    <p><strong>P4 [Cross language]</strong>: Design and implement cross-language
pipeline support, including how the ecosystem of shared transforms
should work.</p>
  </li>
</ul>

<h3 id="issues">Issues</h3>

<p>The portability effort touches every component, so the “portability”
label is used to identify all portability-related issues. Pure
design or proto definitions should use the “beam-model” component. A
common pattern for new portability features is that the overall
feature is in “beam-model” with subtasks for each SDK and runner in
their respective components.</p>

<p><strong>JIRA:</strong> <a href="https://issues.apache.org/jira/issues/?filter=12341256">query</a></p>

<h3 id="status">Status</h3>

<p>MVP in progress (near completion for Flink runner). See the
<a href="https://s.apache.org/apache-beam-portability-support-table">Portability support table</a>
for details.</p>

<h4 id="running-python-wordcount-on-flink">Running Python wordcount on Flink</h4>

<p>The Flink runner is currently the only runner to support portable pipeline execution.
To run a basic Python wordcount (in batch mode) with embedded Flink:</p>

<ol>
  <li>Run once to build the SDK harness container: <code class="highlighter-rouge">./gradlew :beam-sdks-python-container:docker</code></li>
  <li>Start the Flink portable JobService endpoint: <code class="highlighter-rouge">./gradlew :beam-runners-flink_2.11-job-server:runShadow</code></li>
  <li>Submit the wordcount pipeline to above endpoint: <code class="highlighter-rouge">./gradlew :beam-sdks-python:portableWordCount -PjobEndpoint=localhost:8099</code></li>
</ol>

<p>To run the pipeline in streaming mode: <code class="highlighter-rouge">./gradlew :beam-sdks-python:portableWordCount -PjobEndpoint=localhost:8099 -Pstreaming</code></p>

<p>To run on a separate <a href="https://ci.apache.org/projects/flink/flink-docs-release-1.5/quickstart/setup_quickstart.html">Flink cluster</a>:</p>

<ol>
  <li>Start local Flink cluster</li>
  <li>Create shaded JobService jar: <code class="highlighter-rouge">./gradlew :beam-runners-flink_2.11-job-server:installShadowDist</code></li>
  <li>Optional optimization step: Place the generated JobServer Jar <code class="highlighter-rouge">beam/runners/flink/job-server/build/libs/beam-runners-flink_2.11-job-server-2.7.0-SNAPSHOT.jar</code> in <code class="highlighter-rouge">flink/lib</code> and change class loading order for Flink by adding <code class="highlighter-rouge">classloader.resolve-order: parent-first</code> to <code class="highlighter-rouge">conf/flink-conf.yaml</code>.</li>
  <li>Start JobService with Flink web service endpoint: <code class="highlighter-rouge">./gradlew :beam-runners-flink_2.11-job-server:runShadow -PflinkMasterUrl=localhost:8081</code></li>
  <li>Submit the pipeline.</li>
</ol>


      </div>
    </div>
    <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<footer class="footer">
  <div class="footer__contained">
    <div class="footer__cols">
      <div class="footer__cols__col">
        <div class="footer__cols__col__logo">
          <img src="/images/beam_logo_circle.svg" class="footer__logo" alt="Beam logo">
        </div>
        <div class="footer__cols__col__logo">
          <img src="/images/apache_logo_circle.svg" class="footer__logo" alt="Apache logo">
        </div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Start</div>
        <div class="footer__cols__col__link"><a href="/get-started/beam-overview/">Overview</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-java/">Quickstart (Java)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-py/">Quickstart (Python)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-go/">Quickstart (Go)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/downloads/">Downloads</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Docs</div>
        <div class="footer__cols__col__link"><a href="/documentation/programming-guide/">Concepts</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/pipelines/design-your-pipeline/">Pipelines</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/runners/capability-matrix/">Runners</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Community</div>
        <div class="footer__cols__col__link"><a href="/contribute/">Contribute</a></div>
        <div class="footer__cols__col__link"><a href="https://projects.apache.org/committee.html?beam" target="_blank">Team<img src="/images/external-link-icon.png"
                                                                                                                                width="14" height="14"
                                                                                                                                alt="External link."></a></div>
        <div class="footer__cols__col__link"><a href="/contribute/presentation-materials/">Media</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Resources</div>
        <div class="footer__cols__col__link"><a href="/blog/">Blog</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/support/">Support</a></div>
        <div class="footer__cols__col__link"><a href="https://github.com/apache/beam">GitHub</a></div>
      </div>
    </div>
  </div>
  <div class="footer__bottom">
    &copy;
    <a href="http://www.apache.org">The Apache Software Foundation</a>
    | <a href="/privacy_policy">Privacy Policy</a>
    | <a href="/feed.xml">RSS Feed</a>
    <br><br>
    Apache Beam, Apache, Beam, the Beam logo, and the Apache feather logo are
    either registered trademarks or trademarks of The Apache Software
    Foundation. All other products or name brands are trademarks of their
    respective holders, including The Apache Software Foundation.
  </div>
</footer>

  </body>
</html>
