<!doctype html><html lang=en class=no-js><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><title>Web Apis I/O connector</title><meta name=description content="Apache Beam is an open source, unified model and set of language-specific SDKs for defining and executing data processing workflows, and also data ingestion and integration flows, supporting Enterprise Integration Patterns (EIPs) and Domain Specific Languages (DSLs). Dataflow pipelines simplify the mechanics of large-scale batch and streaming data processing and can run on a number of runtimes like Apache Flink, Apache Spark, and Google Cloud Dataflow (a cloud service). Beam also brings DSL in different languages, allowing users to easily implement their data integration processes."><link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700" rel=stylesheet><link rel=preload href=/scss/main.min.408fddfe3e8a45f87a5a8c9a839d77db667c1c534e5e5cd0d957ffc3dd6c14cf.css as=style><link href=/scss/main.min.408fddfe3e8a45f87a5a8c9a839d77db667c1c534e5e5cd0d957ffc3dd6c14cf.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-2.2.4.min.js></script><style>.body__contained img{max-width:100%}</style><script type=text/javascript src=/js/bootstrap.min.2979f9a6e32fc42c3e7406339ee9fe76b31d1b52059776a02b4a7fa6a4fd280a.js defer></script>
<script type=text/javascript src=/js/language-switch-v2.min.121952b7980b920320ab229551857669209945e39b05ba2b433a565385ca44c6.js defer></script>
<script type=text/javascript src=/js/fix-menu.min.039174b67107465f2090a493f91e126f7aa797f29420f9edab8a54d9dd4b3d2d.js defer></script>
<script type=text/javascript src=/js/section-nav.min.1405fd5e70fab5f6c54037c269b1d137487d8f3d1b3009032525f6db3fbce991.js defer></script>
<script type=text/javascript src=/js/page-nav.min.af231204c9c52c5089d53a4c02739eacbb7f939e3be1c6ffcc212e0ac4dbf879.js defer></script>
<script type=text/javascript src=/js/expandable-list.min.75a4526624a3b8898fe7fb9e3428c205b581f8b38c7926922467aef17eac69f2.js defer></script>
<script type=text/javascript src=/js/copy-to-clipboard.min.364c06423d7e8993fc42bb4abc38c03195bc8386db26d18774ce775d08d5b18d.js defer></script>
<script type=text/javascript src=/js/calendar.min.336664054fa0f52b08bbd4e3c59b5cb6d63dcfb2b4d602839746516b0817446b.js defer></script>
<script type=text/javascript src=/js/fix-playground-nested-scroll.min.0283f1037cb1b9d5074c6eaf041292b524a8148a7cdb803d5ccd6d1fc4eb3253.js defer></script>
<script type=text/javascript src=/js/anchor-content-jump-fix.min.22d3240f81632e4c11179b9d2aaf37a40da9414333c43aa97344e8b21a7df0e4.js defer></script>
<link rel=alternate type=application/rss+xml title="Apache Beam" href=/feed.xml><link rel=canonical href=/documentation/io/built-in/webapis/ data-proofer-ignore><link rel="shortcut icon" type=image/x-icon href=/images/favicon.ico><link rel=stylesheet href=https://use.fontawesome.com/releases/v5.4.1/css/all.css integrity=sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz crossorigin=anonymous><link rel=stylesheet href=https://unpkg.com/swiper@8/swiper-bundle.min.css><script async src=https://platform.twitter.com/widgets.js></script>
<script>(function(e,t,n,s,o,i,a){e.GoogleAnalyticsObject=o,e[o]=e[o]||function(){(e[o].q=e[o].q||[]).push(arguments)},e[o].l=1*new Date,i=t.createElement(n),a=t.getElementsByTagName(n)[0],i.async=1,i.src=s,a.parentNode.insertBefore(i,a)})(window,document,"script","//www.google-analytics.com/analytics.js","ga"),ga("create","UA-73650088-1","auto"),ga("send","pageview")</script><script>(function(e,t,n,s,o,i){e.hj=e.hj||function(){(e.hj.q=e.hj.q||[]).push(arguments)},e._hjSettings={hjid:2182187,hjsv:6},o=t.getElementsByTagName("head")[0],i=t.createElement("script"),i.async=1,i.src=n+e._hjSettings.hjid+s+e._hjSettings.hjsv,o.appendChild(i)})(window,document,"https://static.hotjar.com/c/hotjar-",".js?sv=")</script></head><body class=body data-spy=scroll data-target=.page-nav data-offset=0><nav class="navigation-bar-mobile header navbar navbar-fixed-top"><div class=navbar-header><a href=/ class=navbar-brand><img alt=Brand style=height:46px;width:43px src=/images/beam_logo_navbar_mobile.png></a>
<a class=navbar-link href=/get-started/>Get Started</a>
<a class=navbar-link href=/documentation/>Documentation</a>
<button type=button class="navbar-toggle menu-open" aria-expanded=false aria-controls=navbar onclick=openMenu()>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button></div><div class="navbar-mask closed"></div><div id=navbar class="navbar-container closed"><button type=button class=navbar-toggle aria-expanded=false aria-controls=navbar id=closeMenu>
<span class=sr-only>Toggle navigation</span>
<span class=icon-bar></span>
<span class=icon-bar></span>
<span class=icon-bar></span></button><ul class="nav navbar-nav"><li><div class=searchBar-mobile><script>(function(){var t,n="012923275103528129024:4emlchv9wzi",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><gcse:search></gcse:search></div></li><li><a class=navbar-link href=/about>About</a></li><li><a class=navbar-link href=/get-started/>Get Started</a></li><li><span class=navbar-link>Documentation</span><ul><li><a href=/documentation/>General</a></li><li><a href=/documentation/sdks/java/>Languages</a></li><li><a href=/documentation/runners/capability-matrix/>Runners</a></li><li><a href=/documentation/io/connectors/>I/O Connectors</a></li></ul></li><li><a class=navbar-link href=/roadmap/>Roadmap</a></li><li><a class=navbar-link href=/community/>Community</a></li><li><a class=navbar-link href=/contribute/>Contribute</a></li><li><a class=navbar-link href=/blog/>Blog</a></li><li><a class=navbar-link href=/case-studies/>Case Studies</a></li></ul><ul class="nav navbar-nav navbar-right"><li><a href=https://github.com/apache/beam/edit/master/website/www/site/content/en/documentation/io/built-in/webapis.md data-proofer-ignore><svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" fill="none" viewBox="0 0 25 24"><path stroke="#ff6d00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.75" d="M4.543 20h4l10.5-10.5c.53-.53.828-1.25.828-2s-.298-1.47-.828-2-1.25-.828-2-.828-1.47.298-2 .828L4.543 16v4zm9.5-13.5 4 4"/></svg></a></li><li class=dropdown><a href=# class=dropdown-toggle id=apache-dropdown data-toggle=dropdown role=button aria-haspopup=true aria-expanded=false><img src=https://www.apache.org/foundation/press/kit/feather_small.png alt="Apache Logo" style=height:20px>
&nbsp;Apache
<span class=arrow-icon><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><circle cx="10" cy="10" r="10" fill="#ff6d00"/><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.535 5.28l4.573 4.818-4.573 4.403"/></svg></span></a><ul class="dropdown-menu dropdown-menu-right"><li><a target=_blank href=https://www.apache.org/>ASF Homepage</a></li><li><a target=_blank href=https://www.apache.org/licenses/>License</a></li><li><a target=_blank href=https://www.apache.org/security/>Security</a></li><li><a target=_blank href=https://www.apache.org/foundation/thanks.html>Thanks</a></li><li><a target=_blank href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a target=_blank href=https://www.apache.org/foundation/policies/conduct>Code of Conduct</a></li></ul></li></ul></div></nav><nav class=navigation-bar-desktop><a href=/ class=navbar-logo><img src=/images/beam_logo_navbar.png alt="Beam Logo"></a><div class=navbar-bar-left><div class=navbar-links><a class=navbar-link href=/about>About</a>
<a class=navbar-link href=/get-started/>Get Started</a><li class="dropdown navbar-dropdown navbar-dropdown-documentation"><a href=# class="dropdown-toggle navbar-link" role=button aria-haspopup=true aria-expanded=false>Documentation
<span><svg xmlns="http://www.w3.org/2000/svg" width="12" height="11" fill="none" viewBox="0 0 12 11"><path stroke="#ff6d00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.666 4.535 5.847 9.108 1.444 4.535"/></svg></span></a><ul class=dropdown-menu><li><a class=navbar-dropdown-menu-link href=/documentation/>General</a></li><li><a class=navbar-dropdown-menu-link href=/documentation/sdks/java/>Languages</a></li><li><a class=navbar-dropdown-menu-link href=/documentation/runners/capability-matrix/>Runners</a></li><li><a class=navbar-dropdown-menu-link href=/documentation/io/connectors/>I/O Connectors</a></li></ul></li><a class=navbar-link href=/roadmap/>Roadmap</a>
<a class=navbar-link href=/community/>Community</a>
<a class=navbar-link href=/contribute/>Contribute</a>
<a class=navbar-link href=/blog/>Blog</a>
<a class=navbar-link href=/case-studies/>Case Studies</a></div><div id=iconsBar><a type=button onclick=showSearch()><svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" fill="none" viewBox="0 0 25 24"><path stroke="#ff6d00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.75" d="M10.191 17c3.866.0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm11 4-6-6"/></svg></a><a target=_blank href=https://github.com/apache/beam/edit/master/website/www/site/content/en/documentation/io/built-in/webapis.md data-proofer-ignore><svg xmlns="http://www.w3.org/2000/svg" width="25" height="24" fill="none" viewBox="0 0 25 24"><path stroke="#ff6d00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.75" d="M4.543 20h4l10.5-10.5c.53-.53.828-1.25.828-2s-.298-1.47-.828-2-1.25-.828-2-.828-1.47.298-2 .828L4.543 16v4zm9.5-13.5 4 4"/></svg></a><li class="dropdown navbar-dropdown navbar-dropdown-apache"><a href=# class=dropdown-toggle role=button aria-haspopup=true aria-expanded=false><img src=https://www.apache.org/foundation/press/kit/feather_small.png alt="Apache Logo" style=height:20px>
&nbsp;Apache
<span class=arrow-icon><svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 20 20"><circle cx="10" cy="10" r="10" fill="#ff6d00"/><path stroke="#fff" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.535 5.28l4.573 4.818-4.573 4.403"/></svg></span></a><ul class=dropdown-menu><li><a class=navbar-dropdown-menu-link target=_blank href=https://www.apache.org/>ASF Homepage</a></li><li><a class=navbar-dropdown-menu-link target=_blank href=https://www.apache.org/licenses/>License</a></li><li><a class=navbar-dropdown-menu-link target=_blank href=https://www.apache.org/security/>Security</a></li><li><a class=navbar-dropdown-menu-link target=_blank href=https://www.apache.org/foundation/thanks.html>Thanks</a></li><li><a class=navbar-dropdown-menu-link target=_blank href=https://www.apache.org/foundation/sponsorship.html>Sponsorship</a></li><li><a class=navbar-dropdown-menu-link target=_blank href=https://www.apache.org/foundation/policies/conduct>Code of Conduct</a></li></ul></li></div><div class="searchBar disappear"><script>(function(){var t,n="012923275103528129024:4emlchv9wzi",e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="https://cse.google.com/cse.js?cx="+n,t=document.getElementsByTagName("script")[0],t.parentNode.insertBefore(e,t)})()</script><gcse:search></gcse:search>
<a type=button onclick=endSearch()><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25"><path stroke="#ff6d00" stroke-linecap="round" stroke-linejoin="round" stroke-width="2.75" d="M21.122 20.827 4.727 4.432M21.122 4.43 4.727 20.827"/></svg></a></div></div></nav><div class=header-push></div><div class="top-banners swiper"><div class=swiper-wrapper><div class=swiper-slide><a href=https://tour.beam.apache.org><img class=banner-img-desktop src=/images/banners/tour-of-beam/tour-of-beam-desktop.png alt="Start Tour of Beam">
<img class=banner-img-mobile src=/images/banners/tour-of-beam/tour-of-beam-mobile.png alt="Start Tour of Beam"></a></div><div class=swiper-slide><a href=https://beam.apache.org/documentation/ml/overview/><img class=banner-img-desktop src=/images/banners/machine-learning/machine-learning-desktop.jpg alt="Machine Learning">
<img class=banner-img-mobile src=/images/banners/machine-learning/machine-learning-mobile.jpg alt="Machine Learning"></a></div></div><div class=swiper-pagination></div><div class=swiper-button-prev></div><div class=swiper-button-next></div></div><script src=/js/swiper-bundle.min.min.e0e8f81b0b15728d35ff73c07f42ddbb17a108d6f23df4953cb3e60df7ade675.js></script>
<script src=/js/sliders/top-banners.min.afa7d0a19acf7a3b28ca369490b3d401a619562a2a4c9612577be2f66a4b9855.js></script>
<script>function showSearch(){addPlaceholder();var e,t=document.querySelector(".searchBar");t.classList.remove("disappear"),e=document.querySelector("#iconsBar"),e.classList.add("disappear")}function addPlaceholder(){$("input:text").attr("placeholder","What are you looking for?")}function endSearch(){var e,t=document.querySelector(".searchBar");t.classList.add("disappear"),e=document.querySelector("#iconsBar"),e.classList.remove("disappear")}function blockScroll(){$("body").toggleClass("fixedPosition")}function openMenu(){addPlaceholder(),blockScroll()}</script><div class="clearfix container-main-content"><div class="section-nav closed" data-offset-top=90 data-offset-bottom=500><span class="section-nav-back glyphicon glyphicon-menu-left"></span><nav><ul class=section-nav-list data-section-nav><li><span class=section-nav-list-main-title>Documentation</span></li><li><a href=/documentation>Using the Documentation</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Concepts</span><ul class=section-nav-list><li><a href=/documentation/basics/>Basics of the Beam model</a></li><li><a href=/documentation/runtime/model/>How Beam executes a pipeline</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Beam programming guide</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/>Overview</a></li><li><a href=/documentation/programming-guide/#creating-a-pipeline>Pipelines</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>PCollections</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#pcollections>Creating a PCollection</a></li><li><a href=/documentation/programming-guide/#pcollection-characteristics>PCollection characteristics</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Transforms</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#applying-transforms>Applying transforms</a></li><li><span class=section-nav-list-title>Core Beam transforms</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#pardo>ParDo</a></li><li><a href=/documentation/programming-guide/#groupbykey>GroupByKey</a></li><li><a href=/documentation/programming-guide/#cogroupbykey>CoGroupByKey</a></li><li><a href=/documentation/programming-guide/#combine>Combine</a></li><li><a href=/documentation/programming-guide/#flatten>Flatten</a></li><li><a href=/documentation/programming-guide/#partition>Partition</a></li></ul></li><li><a href=/documentation/programming-guide/#requirements-for-writing-user-code-for-beam-transforms>Requirements for user code</a></li><li><a href=/documentation/programming-guide/#side-inputs>Side inputs</a></li><li><a href=/documentation/programming-guide/#additional-outputs>Additional outputs</a></li><li><a href=/documentation/programming-guide/#composite-transforms>Composite transforms</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Pipeline I/O</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#pipeline-io>Using I/O transforms</a></li><li><a href=/documentation/io/connectors/>I/O connectors</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>I/O connector guides</span><ul class=section-nav-list><li><a href=/documentation/io/built-in/parquet/>Apache Parquet I/O connector</a></li><li><a href=/documentation/io/built-in/hadoop/>Hadoop Input/Output Format IO</a></li><li><a href=/documentation/io/built-in/hcatalog/>HCatalog IO</a></li><li><a href=/documentation/io/built-in/google-bigquery/>Google BigQuery I/O connector</a></li><li><a href=/documentation/io/built-in/snowflake/>Snowflake I/O connector</a></li><li><a href=/documentation/io/built-in/cdap/>CDAP I/O connector</a></li><li><a href=/documentation/io/built-in/sparkreceiver/>Spark Receiver I/O connector</a></li><li><a href=/documentation/io/built-in/singlestore/>SingleStoreDB I/O connector</a></li><li><a href=/documentation/io/built-in/webapis/>Web APIs I/O connector</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Developing new I/O connectors</span><ul class=section-nav-list><li><a href=/documentation/io/developing-io-overview/>Overview: Developing connectors</a></li><li><a href=/documentation/io/developing-io-java/>Developing connectors (Java)</a></li><li><a href=/documentation/io/developing-io-python/>Developing connectors (Python)</a></li><li><a href=/documentation/io/io-standards/>I/O Standards</a></li></ul></li><li><a href=/documentation/io/testing/>Testing I/O transforms</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Schemas</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#what-is-a-schema>What is a schema</a></li><li><a href=/documentation/programming-guide/#schemas-for-pl-types>Schemas for programming language types</a></li><li><a href=/documentation/programming-guide/#schema-definition>Schema definition</a></li><li><a href=/documentation/programming-guide/#logical-types>Logical types</a></li><li><a href=/documentation/programming-guide/#creating-schemas>Creating schemas</a></li><li><a href=/documentation/programming-guide/#using-schemas>Using schemas</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Data encoding and type safety</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#data-encoding-and-type-safety>Data encoding basics</a></li><li><a href=/documentation/programming-guide/#specifying-coders>Specifying coders</a></li><li><a href=/documentation/programming-guide/#default-coders-and-the-coderregistry>Default coders and the CoderRegistry</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Windowing</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#windowing>Windowing basics</a></li><li><a href=/documentation/programming-guide/#provided-windowing-functions>Provided windowing functions</a></li><li><a href=/documentation/programming-guide/#setting-your-pcollections-windowing-function>Setting your PCollection’s windowing function</a></li><li><a href=/documentation/programming-guide/#watermarks-and-late-data>Watermarks and late data</a></li><li><a href=/documentation/programming-guide/#adding-timestamps-to-a-pcollections-elements>Adding timestamps to a PCollection’s elements</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Triggers</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#triggers>Trigger basics</a></li><li><a href=/documentation/programming-guide/#event-time-triggers>Event time triggers and the default trigger</a></li><li><a href=/documentation/programming-guide/#processing-time-triggers>Processing time triggers</a></li><li><a href=/documentation/programming-guide/#data-driven-triggers>Data-driven triggers</a></li><li><a href=/documentation/programming-guide/#setting-a-trigger>Setting a trigger</a></li><li><a href=/documentation/programming-guide/#composite-triggers>Composite triggers</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Metrics</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#metrics>Metrics basics</a></li><li><a href=/documentation/programming-guide/#types-of-metrics>Types of metrics</a></li><li><a href=/documentation/programming-guide/#querying-metrics>Querying metrics</a></li><li><a href=/documentation/programming-guide/#using-metrics>Using metrics in pipeline</a></li><li><a href=/documentation/programming-guide/#export-metrics>Export metrics</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>State and Timers</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#types-of-state>Types of state</a></li><li><a href=/documentation/programming-guide/#deferred-state-reads>Deferred state reads</a></li><li><a href=/documentation/programming-guide/#timers>Timers</a></li><li><a href=/documentation/programming-guide/#garbage-collecting-state>Garbage collecting state</a></li><li><a href=/documentation/programming-guide/#state-timers-examples>State and timers examples</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Splittable DoFns</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#sdf-basics>Basics</a></li><li><a href=/documentation/programming-guide/#sizing-and-progress>Sizing and progress</a></li><li><a href=/documentation/programming-guide/#user-initiated-checkpoint>User-initiated checkpoint</a></li><li><a href=/documentation/programming-guide/#runner-initiated-split>Runner initiated split</a></li><li><a href=/documentation/programming-guide/#watermark-estimation>Watermark estimation</a></li><li><a href=/documentation/programming-guide/#truncating-during-drain>Truncating during drain</a></li><li><a href=/documentation/programming-guide/#bundle-finalization>Bundle finalization</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Multi-language Pipelines</span><ul class=section-nav-list><li><a href=/documentation/programming-guide/#create-x-lang-transforms>Creating cross-language transforms</a></li><li><a href=/documentation/programming-guide/#use-x-lang-transforms>Using cross-language transforms</a></li><li><a href=/documentation/programming-guide/#x-lang-transform-runner-support>Runner Support</a></li></ul></li><li><a href=/documentation/programming-guide/#batched-dofns>Batched DoFns</a></li><li><a href=/documentation/programming-guide/#transform-service>Transform service</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Pipeline development lifecycle</span><ul class=section-nav-list><li><a href=/documentation/pipelines/design-your-pipeline/>Design Your Pipeline</a></li><li><a href=/documentation/pipelines/create-your-pipeline/>Create Your Pipeline</a></li><li><a href=/documentation/pipelines/test-your-pipeline/>Test Your Pipeline</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Common pipeline patterns</span><ul class=section-nav-list><li><a href=/documentation/patterns/overview/>Overview</a></li><li><a href=/documentation/patterns/file-processing/>File processing</a></li><li><a href=/documentation/patterns/side-inputs/>Side inputs</a></li><li><a href=/documentation/patterns/pipeline-options/>Pipeline options</a></li><li><a href=/documentation/patterns/custom-io/>Custom I/O</a></li><li><a href=/documentation/patterns/custom-windows/>Custom windows</a></li><li><a href=/documentation/patterns/bigqueryio/>BigQueryIO</a></li><li><a href=/documentation/patterns/ai-platform/>AI Platform</a></li><li><a href=/documentation/patterns/schema/>Schema</a></li><li><a href=/documentation/patterns/bqml/>BigQuery ML</a></li><li><a href=/documentation/patterns/grouping-elements-for-efficient-external-service-calls/>Grouping elements for efficient external service calls</a></li><li><a href=/documentation/patterns/shared-class/>Cache using a shared object</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>AI/ML pipelines</span><ul class=section-nav-list><li><a href=/documentation/ml/overview/>Get started with AI/ML</a></li><li><a href=/documentation/ml/about-ml/>About Beam ML</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Prediction and inference</span><ul class=section-nav-list><li><a href=/documentation/ml/inference-overview/>Overview</a></li><li><a href=/documentation/ml/multi-model-pipelines/>Build a pipeline with multiple models</a></li><li><a href=/documentation/ml/tensorrt-runinference>Build a custom model handler with TensorRT</a></li><li><a href=/documentation/ml/large-language-modeling>Use LLM inference</a></li><li><a href=/documentation/ml/multi-language-inference/>Build a multi-language inference pipeline</a></li><li><a href=/documentation/ml/side-input-updates/>Update your model in production</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Data processing</span><ul class=section-nav-list><li><a href=/documentation/ml/preprocess-data/>Preprocess data</a></li><li><a href=/documentation/ml/data-processing/>Explore your data</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Workflow orchestration</span><ul class=section-nav-list><li><a href=/documentation/ml/orchestration/>Use ML-OPS workflow orchestrators</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Model training</span><ul class=section-nav-list><li><a href=/documentation/ml/per-entity-training>Per-entity training</a></li><li><a href=/documentation/ml/online-clustering/>Online clustering</a></li><li><a href=/documentation/ml/model-evaluation/>ML model evaluation</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Use cases</span><ul class=section-nav-list><li><a href=/documentation/ml/anomaly-detection/>Build an anomaly detection pipeline</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Reference</span><ul class=section-nav-list><li><a href=/documentation/ml/runinference-metrics/>RunInference metrics</a></li><li><a href=/documentation/ml/model-evaluation/>Model validation</a></li></ul></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Runtime systems</span><ul class=section-nav-list><li><a href=/documentation/runtime/environments/>Container environments</a></li><li><a href=/documentation/runtime/resource-hints/>Resource hints</a></li><li><a href=/documentation/runtime/sdk-harness-config/>SDK Harness Configuration</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Transform catalog</span><ul class=section-nav-list><li class=section-nav-item--collapsible><span class=section-nav-list-title>Python</span><ul class=section-nav-list><li><a href=/documentation/transforms/python/overview/>Overview</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Element-wise</span><ul class=section-nav-list><li class=section-nav-item--collapsible><span class=section-nav-list-title>Enrichment</span><ul class=section-nav-list><li><a href=/documentation/transforms/python/elementwise/enrichment/>Overview</a></li><li><a href=/documentation/transforms/python/elementwise/enrichment-bigtable/>Bigtable example</a></li><li><a href=/documentation/transforms/python/elementwise/enrichment-vertexai/>Vertex AI Feature Store examples</a></li></ul></li><li><a href=/documentation/transforms/python/elementwise/filter/>Filter</a></li><li><a href=/documentation/transforms/python/elementwise/flatmap/>FlatMap</a></li><li><a href=/documentation/transforms/python/elementwise/keys/>Keys</a></li><li><a href=/documentation/transforms/python/elementwise/kvswap/>KvSwap</a></li><li><a href=/documentation/transforms/python/elementwise/map/>Map</a></li><li><a href=/documentation/transforms/python/elementwise/mltransform/>MLTransform</a></li><li><a href=/documentation/transforms/python/elementwise/pardo/>ParDo</a></li><li><a href=/documentation/transforms/python/elementwise/partition/>Partition</a></li><li><a href=/documentation/transforms/python/elementwise/regex/>Regex</a></li><li><a href=/documentation/transforms/python/elementwise/reify/>Reify</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>RunInference</span><ul class=section-nav-list><li><a href=/documentation/transforms/python/elementwise/runinference/>Overview</a></li><li><a href=/documentation/transforms/python/elementwise/runinference-pytorch/>PyTorch examples</a></li><li><a href=/documentation/transforms/python/elementwise/runinference-sklearn/>Sklearn examples</a></li></ul></li><li><a href=/documentation/transforms/python/elementwise/tostring/>ToString</a></li><li><a href=/documentation/transforms/python/elementwise/values/>Values</a></li><li><a href=/documentation/transforms/python/elementwise/withtimestamps/>WithTimestamps</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Aggregation</span><ul class=section-nav-list><li><a href=/documentation/transforms/python/aggregation/approximatequantiles/>ApproximateQuantiles</a></li><li><a href=/documentation/transforms/python/aggregation/approximateunique/>ApproximateUnique</a></li><li><a href=/documentation/transforms/python/aggregation/batchelements/>BatchElements</a></li><li><a href=/documentation/transforms/python/aggregation/cogroupbykey/>CoGroupByKey</a></li><li><a href=/documentation/transforms/python/aggregation/combineglobally/>CombineGlobally</a></li><li><a href=/documentation/transforms/python/aggregation/combineperkey/>CombinePerKey</a></li><li><a href=/documentation/transforms/python/aggregation/combinevalues/>CombineValues</a></li><li><a href=/documentation/transforms/python/aggregation/count/>Count</a></li><li><a href=/documentation/transforms/python/aggregation/distinct/>Distinct</a></li><li><a href=/documentation/transforms/python/aggregation/groupby/>GroupBy</a></li><li><a href=/documentation/transforms/python/aggregation/groupbykey/>GroupByKey</a></li><li><a href=/documentation/transforms/python/aggregation/groupintobatches/>GroupIntoBatches</a></li><li><a href=/documentation/transforms/python/aggregation/latest/>Latest</a></li><li><a href=/documentation/transforms/python/aggregation/max/>Max</a></li><li><a href=/documentation/transforms/python/aggregation/mean/>Mean</a></li><li><a href=/documentation/transforms/python/aggregation/min/>Min</a></li><li><a href=/documentation/transforms/python/aggregation/sample/>Sample</a></li><li><a href=/documentation/transforms/python/aggregation/sum/>Sum</a></li><li><a href=/documentation/transforms/python/aggregation/top/>Top</a></li><li><a href=/documentation/transforms/python/aggregation/tolist/>ToList</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Other</span><ul class=section-nav-list><li><a href=/documentation/transforms/python/other/create/>Create</a></li><li><a href=/documentation/transforms/python/other/flatten/>Flatten</a></li><li><a href=/documentation/transforms/python/other/reshuffle/>Reshuffle</a></li><li><a href=/documentation/transforms/python/other/windowinto/>WindowInto</a></li></ul></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Java</span><ul class=section-nav-list><li><a href=/documentation/transforms/java/overview/>Overview</a></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Element-wise</span><ul class=section-nav-list><li><a href=/documentation/transforms/java/elementwise/filter/>Filter</a></li><li><a href=/documentation/transforms/java/elementwise/flatmapelements/>FlatMapElements</a></li><li><a href=/documentation/transforms/java/elementwise/keys/>Keys</a></li><li><a href=/documentation/transforms/java/elementwise/kvswap/>KvSwap</a></li><li><a href=/documentation/transforms/java/elementwise/mapelements/>MapElements</a></li><li><a href=/documentation/transforms/java/elementwise/pardo/>ParDo</a></li><li><a href=/documentation/transforms/java/elementwise/partition/>Partition</a></li><li><a href=/documentation/transforms/java/elementwise/regex/>Regex</a></li><li><a href=/documentation/transforms/java/elementwise/reify/>Reify</a></li><li><a href=/documentation/transforms/java/elementwise/tostring/>ToString</a></li><li><a href=/documentation/transforms/java/elementwise/values/>Values</a></li><li><a href=/documentation/transforms/java/elementwise/withkeys/>WithKeys</a></li><li><a href=/documentation/transforms/java/elementwise/withtimestamps/>WithTimestamps</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Aggregation</span><ul class=section-nav-list><li><a href=/documentation/transforms/java/aggregation/approximatequantiles/>ApproximateQuantiles</a></li><li><a href=/documentation/transforms/java/aggregation/approximateunique/>ApproximateUnique</a></li><li><a href=/documentation/transforms/java/aggregation/cogroupbykey/>CoGroupByKey</a></li><li><a href=/documentation/transforms/java/aggregation/combine/>Combine</a></li><li><a href=/documentation/transforms/java/aggregation/combinewithcontext/>CombineWithContext</a></li><li><a href=/documentation/transforms/java/aggregation/count/>Count</a></li><li><a href=/documentation/transforms/java/aggregation/distinct/>Distinct</a></li><li><a href=/documentation/transforms/java/aggregation/groupbykey/>GroupByKey</a></li><li><a href=/documentation/transforms/java/aggregation/groupintobatches/>GroupIntoBatches</a></li><li><a href=/documentation/transforms/java/aggregation/hllcount/>HllCount</a></li><li><a href=/documentation/transforms/java/aggregation/latest/>Latest</a></li><li><a href=/documentation/transforms/java/aggregation/max/>Max</a></li><li><a href=/documentation/transforms/java/aggregation/mean/>Mean</a></li><li><a href=/documentation/transforms/java/aggregation/min/>Min</a></li><li><a href=/documentation/transforms/java/aggregation/sample/>Sample</a></li><li><a href=/documentation/transforms/java/aggregation/sum/>Sum</a></li><li><a href=/documentation/transforms/java/aggregation/top/>Top</a></li></ul></li><li class=section-nav-item--collapsible><span class=section-nav-list-title>Other</span><ul class=section-nav-list><li><a href=/documentation/transforms/java/other/create/>Create</a></li><li><a href=/documentation/transforms/java/other/flatten/>Flatten</a></li><li><a href=/documentation/transforms/java/other/passert/>PAssert</a></li><li><a href=/documentation/transforms/java/other/view/>View</a></li><li><a href=/documentation/transforms/java/other/window/>Window</a></li></ul></li></ul></li></ul></li><li><a href=/documentation/glossary/>Glossary</a></li><li><a href=https://cwiki.apache.org/confluence/display/BEAM/Apache+Beam>Beam Wiki <img src=/images/external-link-icon.png width=14 height=14 alt="External link."></a></li></ul></nav></div><nav class="page-nav clearfix" data-offset-top=90 data-offset-bottom=500><nav id=TableOfContents><ul><li><a href=#requestresponseio-features>RequestResponseIO Features</a></li><li><a href=#additional-resources>Additional resources</a></li><li><a href=#before-you-start>Before you start</a></li><li><a href=#requestresponseio-basics>RequestResponseIO basics</a><ul><li><a href=#minimal-code>Minimal code</a><ul><li><a href=#implementing-the-caller>Implementing the Caller</a></li><li><a href=#instantiate-requestresponseio>Instantiate RequestResponseIO</a></li></ul></li><li><a href=#api-call-repeats-and-failures>API call repeats and failures</a><ul><li><a href=#handling-failures>Handling failures</a></li><li><a href=#api-call-repeats-and-backoff>API call repeats and backoff</a></li><li><a href=#testing>Testing</a></li></ul></li></ul></li><li><a href=#practical-examples>Practical examples</a><ul><li><a href=#working-with-http-calls-directly>Working with HTTP calls directly</a><ul><li><a href=#define-caller>Define Caller</a></li><li><a href=#define-request>Define request</a></li><li><a href=#define-response>Define response</a></li><li><a href=#define-response-coder>Define response coder</a></li><li><a href=#acquire-image-data-from-urls>Acquire image data from URLs</a></li></ul></li><li><a href=#using-api-client-code>Using API client code</a><ul><li><a href=#define-caller-with-setupteardown>Define Caller with SetupTeardown</a></li><li><a href=#ask-gemini-ai-to-identify-the-image>Ask Gemini AI to identify the image</a></li></ul></li></ul></li></ul></nav></nav><div class="body__contained body__section-nav arrow-list arrow-list--no-mt"><p><a href=/documentation/io/built-in/>Built-in I/O Transforms</a></p><h1 id=web-apis-io-connector>Web APIs I/O connector</h1><nav class=language-switcher><strong>Adapt for:</strong><ul><li data-value=java class=active>Java SDK</li></ul></nav><p>The Beam SDKs include a built-in transform, called RequestResponseIO to support reads and writes with Web APIs such as
REST or gRPC.</p><p>Discussion below focuses on the Java SDK. Python examples will be added in the future; see tracker issue:
<a href=https://github.com/apache/beam/issues/30422>#30422</a>. Additionally, support for the Go SDK is not yet available;
see tracker issue: <a href=https://github.com/apache/beam/issues/30423>#30423</a>.</p><h2 id=requestresponseio-features>RequestResponseIO Features</h2><p>Features this transform provides include:</p><ul><li>developers provide minimal code that invokes Web API endpoint</li><li>delegate to the transform to handle request retries and exponential backoff</li><li>optional caching of request and response associations</li><li>optional metrics</li></ul><p>This guide currently focuses on the first two bullet points above, the minimal code requirements and error handling.
In the future, it may be expanded to show examples of additional features. Links to additional resources is
provided below.</p><h2 id=additional-resources>Additional resources</h2><span class=language-java><ul><li><a href=https://github.com/apache/beam/tree/master/sdks/java/io/rrio>RequestResponseIO source code</a></li><li><a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/RequestResponseIO.html>RequestResponseIO Javadoc</a></li></ul></span><h2 id=before-you-start>Before you start</h2><p class=language-java>To use RequestResponseIO, add the dependency to your <a href=https://gradle.org>Gradle</a> <code>build.gradle(.kts)</code> or
<a href=https://maven.apache.org/>Maven</a> <code>pom.xml</code> file. See
<a href=https://central.sonatype.com/artifact/org.apache.beam/beam-sdks-java-io-rrio>Maven Central</a> for available versions.</p><p class=language-java>Below shows an example adding the <a href=https://central.sonatype.com/artifact/org.apache.beam/beam-sdks-java-bom>Beam BOM</a>
and related dependencies such as Beam core to your <code>build.gradle(.kts)</code> file.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Apache Beam BOM
</span></span></span><span class=line><span class=cl><span class=c1>// https://central.sonatype.com/artifact/org.apache.beam/beam-sdks-java-bom
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>implementation</span><span class=o>(</span><span class=s>&#34;org.apache.beam:beam-sdks-java-bom:2.60.0&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Beam Core SDK
</span></span></span><span class=line><span class=cl><span class=c1>// https://central.sonatype.com/artifact/org.apache.beam/beam-sdks-java-core
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>implementation</span><span class=o>(</span><span class=s>&#34;org.apache.beam:beam-sdks-java-core&#34;</span><span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// RequestResponseIO dependency
</span></span></span><span class=line><span class=cl><span class=c1>// https://central.sonatype.com/artifact/org.apache.beam/beam-sdks-java-io-rrio
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>implementation</span><span class=o>(</span><span class=s>&#34;org.apache.beam:beam-sdks-java-io-rrio&#34;</span><span class=o>)</span></span></span></code></pre></div></div></div><p class=language-java>Or using Maven, add the artifact dependency to your <code>pom.xml</code> file.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=o>&lt;</span><span class=n>dependency</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=n>groupId</span><span class=o>&gt;</span><span class=n>org</span><span class=o>.</span><span class=na>apache</span><span class=o>.</span><span class=na>beam</span><span class=o>&lt;/</span><span class=n>groupId</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=n>artifactId</span><span class=o>&gt;</span><span class=n>beam</span><span class=o>-</span><span class=n>sdks</span><span class=o>-</span><span class=n>java</span><span class=o>-</span><span class=n>io</span><span class=o>-</span><span class=n>rrio</span><span class=o>&lt;/</span><span class=n>artifactId</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl>    <span class=o>&lt;</span><span class=n>version</span><span class=o>&gt;</span><span class=n>2</span><span class=o>.</span><span class=na>60</span><span class=o>.</span><span class=na>0</span><span class=o>&lt;/</span><span class=n>version</span><span class=o>&gt;</span>
</span></span><span class=line><span class=cl><span class=o>&lt;/</span><span class=n>dependency</span><span class=o>&gt;</span></span></span></code></pre></div></div></div><h2 id=requestresponseio-basics>RequestResponseIO basics</h2><h3 id=minimal-code>Minimal code</h3><p>The minimal code needed to read from or write to Web APIs is:</p><span class=language-java><ol><li><a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Caller.html>Caller</a> implementation.</li><li>Instantiate <a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/RequestResponseIO.html>RequestResponseIO</a>.</li></ol></span><h4 id=implementing-the-caller>Implementing the Caller</h4><p class=language-java><a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Caller.html>Caller</a> requires
only one method override: <a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Caller.html#call-RequestT->call</a>, whose
purpose is to interact with the API, converting a request into a response.
The transform&rsquo;s DoFn invokes this method within its
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/transforms/DoFn.ProcessElement.html>DoFn.ProcessElement</a>
method. The transform handles everything else including repeating failed requests and exponential backoff
(discussed more below).</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// MyCaller invokes a Web API with MyRequest and returns the resulting MyResponse.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>MyCaller</span><span class=o>&lt;</span><span class=n>MyRequest</span><span class=o>,</span> <span class=n>MyResponse</span><span class=o>&gt;</span> <span class=kd>implements</span> <span class=n>Caller</span><span class=o>&lt;</span><span class=n>MyRequest</span><span class=o>,</span> <span class=n>MyResponse</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>MyResponse</span> <span class=nf>call</span><span class=o>(</span><span class=n>MyRequest</span> <span class=n>request</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=c1>// Do something with request and return the response.
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h4 id=instantiate-requestresponseio>Instantiate RequestResponseIO</h4><p class=language-java>Using <a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/RequestResponseIO.html>RequestResponseIO</a>
is as simple as shown below. As mentioned, it minimally requires two parameters: the <code>Caller</code> and the expected
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/coders/Coder.html>Coder</a> of the response. (<em>Note: If the concept of a Beam Coder is new to you, please see the
<a href=/documentation/programming-guide/#data-encoding-and-type-safety>Apache Beam Programming Guide</a>
on this subject. This guide also has an example below.</em>)</p><p class=language-java><p>The <code>RequestResponseIO</code> transform returns a <a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Result.html>Result</a>
that bundles any failures and the <code>PCollection</code> of successful responses. In Beam, we call this the
<a href=/documentation/programming-guide/#additional-outputs>additional outputs</a> pattern,
which typically requires a bit of boilerplate but the transform takes care of it for you. Using the transform,
you get the success and failure <code>PCollection</code>s via
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Result.html#getFailures-->Result::getFailures</a>
and <a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Result.html#getResponses-->Result::getResponses</a>.</p><p>Below shows an abbreviated snippet how the transform may work in your pipeline.</p></p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=c1>// Step 1. Define the Coder for the response.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Coder</span><span class=o>&lt;</span><span class=n>MyResponse</span><span class=o>&gt;</span> <span class=n>responseCoder</span> <span class=o>=</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 2. Build the request PCollection.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>PCollection</span><span class=o>&lt;</span><span class=n>MyRequest</span><span class=o>&gt;</span> <span class=n>requests</span> <span class=o>=</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 3. Instantiate the RequestResponseIO with the Caller and Coder and apply it to the request PCollection.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>Result</span><span class=o>&lt;</span><span class=n>MyResponse</span><span class=o>&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=n>RequestResponseIO</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=k>new</span> <span class=n>MyCaller</span><span class=o>(),</span> <span class=n>responseCoder</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 4a. Do something with the responses.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>result</span><span class=o>.</span><span class=na>getResponses</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span> <span class=o>...</span> <span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// Step 4b. Apply failures to a dead letter sink.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=n>result</span><span class=o>.</span><span class=na>getFailures</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span> <span class=o>...</span> <span class=o>);</span></span></span></code></pre></div></div></div><p><code>RequestResponseIO</code> takes care of everything else needed to invoke the <code>Caller</code> for each request. It doesn&rsquo;t care what
you do inside your <code>Caller</code>, whether you make raw HTTP calls or use client code. Later this guide discusses the
advantage of this design for testing.</p><h3 id=api-call-repeats-and-failures>API call repeats and failures</h3><p>As mentioned above, <code>RequestResponseIO</code> returns a
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/Result.html>Result</a>
that bundles both the success and failure <code>PCollection</code>s resulting from your <code>Caller</code>. This section provides
a little more detail about handling failures and specifics on API call repeats with backoff.</p><h4 id=handling-failures>Handling failures</h4><p>The failures are an
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/ApiIOError.html>ApiIOError</a>
<code>PCollection</code> that you may apply to a logging transform or a transform that
saves the errors to a downstream sink for later analysis and troubleshooting.</p><p>Since <code>ApiIOError</code> is already mapped to a Beam Schema, it has compatibility with most of Beam&rsquo;s existing I/O
connectors.
(<em>Note: If the concept of Beam Schemas is new to you, please see the
<a href=/documentation/programming-guide/#schemas>Beam Programming Guide</a>.</em>)
For example, you can easily send <code>ApiIOError</code> records to BigQuery for analysis and troubleshooting as shown
below <strong>without</strong> converting the records first to a
<a href=https://www.javadoc.io/doc/com.google.apis/google-api-services-bigquery/v2-rev20230812-2.0.0/com/google/api/services/bigquery/model/TableRow.html>TableRow</a>.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>static</span> <span class=kt>void</span> <span class=nf>writeFailuresToBigQuery</span><span class=o>(</span>
</span></span><span class=line><span class=cl>    <span class=n>PCollection</span><span class=o>&lt;</span><span class=n>ApiIOError</span><span class=o>&gt;</span> <span class=n>failures</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>TableReference</span> <span class=n>tableReference</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BigQueryIO</span><span class=o>.</span><span class=na>Write</span><span class=o>.</span><span class=na>CreateDisposition</span> <span class=n>createDisposition</span><span class=o>,</span>
</span></span><span class=line><span class=cl>    <span class=n>BigQueryIO</span><span class=o>.</span><span class=na>Write</span><span class=o>.</span><span class=na>WriteDisposition</span> <span class=n>writeDisposition</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=c1>// PCollection&lt;ApiIOError&gt; failures = ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// TableReference tableReference = ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// BigQueryIO.Write.CreateDisposition createDisposition = ...
</span></span></span><span class=line><span class=cl><span class=c1></span>  <span class=c1>// BigQueryIO.Write.WriteDisposition writeDisposition = ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>  <span class=n>failures</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span>
</span></span><span class=line><span class=cl>      <span class=s>&#34;Dead letter&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>      <span class=n>BigQueryIO</span><span class=o>.&lt;</span><span class=n>ApiIOError</span><span class=o>&gt;</span><span class=n>write</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>useBeamSchema</span><span class=o>()</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>to</span><span class=o>(</span><span class=n>tableReference</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>withCreateDisposition</span><span class=o>(</span><span class=n>createDisposition</span><span class=o>)</span>
</span></span><span class=line><span class=cl>          <span class=o>.</span><span class=na>withWriteDisposition</span><span class=o>(</span><span class=n>writeDisposition</span><span class=o>));</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h4 id=api-call-repeats-and-backoff>API call repeats and backoff</h4><p>Prior to emitting to the failure <code>PCollection</code>, the transform performs a retry <strong>for certain errors</strong>
after a prescribed exponential backoff. Your <code>Caller</code> must throw specific errors, to signal the transform
to perform the retry with backoff. Throwing a
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/UserCodeExecutionException.html>UserCodeExecutionException</a>
will immediately emit the error into the <code>ApiIOError</code> <code>PCollection</code>.</p><p><code>RequestResponseIO</code> will attempt a retry with backoff when <code>Caller</code> throws:</p><ul><li><a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/UserCodeQuotaException.html>UserCodeQuotaException</a></li><li><a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/UserCodeRemoteSystemException.html>UserCodeRemoteSystemException</a></li><li><a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/UserCodeTimeoutException.html>UserCodeTimeoutException</a></li></ul><p>After a threshold number of retries, the error is emitted into the failure <code>PCollection</code>.</p><h4 id=testing>Testing</h4><p>Since <code>RequestResponseIO</code> doesn&rsquo;t care what you do inside your <code>Caller</code> implementation, this makes some testing more convenient.
Instead of relying on direct calls to a real API within some tests, consequently depending on your external resource,
you simply implement a version of your <code>Caller</code>
returning responses or throwing exceptions, according to your test logic.
For example, if you want to test a downstream step in your pipeline for a specific response, say empty records, you
could easily do so via the following. For more information on testing your Beam Pipelines, see
the <a href=/documentation/pipelines/test-your-pipeline/>Beam Programming Guide</a>.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=nd>@Test</span>
</span></span><span class=line><span class=cl><span class=kt>void</span> <span class=nf>givenEmptyResponse_thenExpectSomething</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>// Test expects PTransform underTest should do something as a result of empty records, for example.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PTransform</span><span class=o>&lt;</span><span class=n>Iterable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;,</span> <span class=o>?&gt;</span> <span class=n>underTest</span> <span class=o>=</span> <span class=o>...</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>PCollection</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>requests</span> <span class=o>=</span> <span class=n>pipeline</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=n>Create</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=s>&#34;aRequest&#34;</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=n>IterableCoder</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>coder</span> <span class=o>=</span> <span class=n>IterableCoder</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>StringUtf8Coder</span><span class=o>.</span><span class=na>of</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>Result</span><span class=o>&lt;</span><span class=n>Iterable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=n>result</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span><span class=n>RequestResponseIO</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=k>new</span> <span class=n>MockEmptyIterableResponse</span><span class=o>()),</span> <span class=n>coder</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>PAssert</span><span class=o>.</span><span class=na>that</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>getResponses</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span><span class=n>underTest</span><span class=o>)).</span><span class=na>containsInAnyOrder</span><span class=o>(...)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pipeline</span><span class=o>.</span><span class=na>run</span><span class=o>();</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1>// MockEmptyIterableResponse simulates when there are no results from the API.
</span></span></span><span class=line><span class=cl><span class=c1></span><span class=kd>class</span> <span class=nc>MockEmptyIterableResponse</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=kd>implements</span> <span class=n>Caller</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl><span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>Iterable</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>call</span><span class=o>(</span><span class=n>String</span> <span class=n>request</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>Collections</span><span class=o>.</span><span class=na>emptyList</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h2 id=practical-examples>Practical examples</h2><p>Below shows two examples that we will bring together in an end-to-end Beam pipeline. The goal of this pipeline is to
download images and use
<a href=https://cloud.google.com/vertex-ai/generative-ai/docs/start/quickstarts/quickstart-multimodal>Gemini on Vertex AI</a>
to recognize the image content.</p><p>Note that this example does not replace our current AI/ML solutions. Please see
<a href=/documentation/ml/overview/>Get started with AI/ML pipelines</a>
for more details on using Beam with AI/ML.</p><h3 id=working-with-http-calls-directly>Working with HTTP calls directly</h3><p>We first need to download images. To do so, we need to make HTTP calls to the image URL and emit their content
into a <code>PCollection</code> for use with the Gemini API. The value of this example on its own is that it demonstrates
how to use <code>RequestResponseIO</code> to make raw HTTP requests.</p><h4 id=define-caller>Define Caller</h4><p>We implement the <code>Caller</code>, the <code>HttpImageClient</code>, that receives an <code>ImageRequest</code> and returns an <code>ImageResponse</code>.</p><p><em>For demo purposes, the example uses a
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/values/KV.html>KV</a>
to preserve the raw URL in the returned <code>ImageResponse</code> containing <code>KV</code>.</em></p><h5 id=abbreviated-snippet>Abbreviated snippet</h5><p>Below shows an abbreviated version of the <code>HttpImageClient</code> showing the important parts.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>HttpImageClient</span> <span class=kd>implements</span> <span class=n>Caller</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageRequest</span><span class=o>&gt;,</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>HttpRequestFactory</span> <span class=n>REQUEST_FACTORY</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=k>new</span> <span class=n>NetHttpTransport</span><span class=o>().</span><span class=na>createRequestFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;</span> <span class=nf>call</span><span class=o>(</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageRequest</span><span class=o>&gt;</span> <span class=n>requestKV</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>ImageRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=n>requestKV</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>        <span class=n>GenericUrl</span> <span class=n>url</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericUrl</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getImageUrl</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>HttpRequest</span> <span class=n>imageRequest</span> <span class=o>=</span> <span class=n>REQUEST_FACTORY</span><span class=o>.</span><span class=na>buildGetRequest</span><span class=o>(</span><span class=n>url</span><span class=o>);</span>
</span></span><span class=line><span class=cl>        <span class=n>HttpResponse</span> <span class=n>response</span> <span class=o>=</span> <span class=n>imageRequest</span><span class=o>.</span><span class=na>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>KV</span><span class=o>.</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>requestKV</span><span class=o>.</span><span class=na>getKey</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>ImageResponse</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>                <span class=c1>// Build ImageResponse from HttpResponse
</span></span></span><span class=line><span class=cl><span class=c1></span>                <span class=o>.</span><span class=na>build</span><span class=o>()</span>
</span></span><span class=line><span class=cl>        <span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h5 id=full-example>Full example</h5><p>The full implementation is shown below illustrating throwing various exceptions based on the HTTP response code.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Implements {@link Caller} to process an {@link ImageRequest} into an {@link ImageResponse} by
</span></span></span><span class=line><span class=cl><span class=cm> * invoking the HTTP request.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>HttpImageClient</span> <span class=kd>implements</span> <span class=n>Caller</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageRequest</span><span class=o>&gt;,</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>STATUS_TOO_MANY_REQUESTS</span> <span class=o>=</span> <span class=n>429</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=kt>int</span> <span class=n>STATUS_TIMEOUT</span> <span class=o>=</span> <span class=n>408</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>HttpRequestFactory</span> <span class=n>REQUEST_FACTORY</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=k>new</span> <span class=n>NetHttpTransport</span><span class=o>().</span><span class=na>createRequestFactory</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>HttpImageClient</span> <span class=nf>of</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>HttpImageClient</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Invokes an HTTP Get request from the {@param request}, returning an {@link ImageResponse}
</span></span></span><span class=line><span class=cl><span class=cm>   * containing the image data.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;</span> <span class=nf>call</span><span class=o>(</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageRequest</span><span class=o>&gt;</span> <span class=n>requestKV</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>requestKV</span><span class=o>.</span><span class=na>getKey</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>ImageRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=n>requestKV</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>Preconditions</span><span class=o>.</span><span class=na>checkArgument</span><span class=o>(</span><span class=n>request</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>GenericUrl</span> <span class=n>url</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenericUrl</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getImageUrl</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>HttpRequest</span> <span class=n>imageRequest</span> <span class=o>=</span> <span class=n>REQUEST_FACTORY</span><span class=o>.</span><span class=na>buildGetRequest</span><span class=o>(</span><span class=n>url</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=n>HttpResponse</span> <span class=n>response</span> <span class=o>=</span> <span class=n>imageRequest</span><span class=o>.</span><span class=na>execute</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusCode</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=n>500</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=c1>// Tells transform to repeat the request.
</span></span></span><span class=line><span class=cl><span class=c1></span>        <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeRemoteSystemException</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusCode</span><span class=o>()</span> <span class=o>&gt;=</span> <span class=n>400</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>switch</span> <span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusCode</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=n>STATUS_TOO_MANY_REQUESTS</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Tells transform to repeat the request.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeQuotaException</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>          <span class=k>case</span> <span class=n>STATUS_TIMEOUT</span><span class=o>:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Tells transform to repeat the request.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeTimeoutException</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl><span class=nl>
</span></span></span><span class=line><span class=cl><span class=nl>          default:</span>
</span></span><span class=line><span class=cl>            <span class=c1>// Tells the tranform to emit immediately into failure PCollection.
</span></span></span><span class=line><span class=cl><span class=c1></span>            <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeExecutionException</span><span class=o>(</span><span class=n>response</span><span class=o>.</span><span class=na>getStatusMessage</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>InputStream</span> <span class=n>is</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=na>getContent</span><span class=o>();</span>
</span></span><span class=line><span class=cl>      <span class=kt>byte</span><span class=o>[]</span> <span class=n>bytes</span> <span class=o>=</span> <span class=n>ByteStreams</span><span class=o>.</span><span class=na>toByteArray</span><span class=o>(</span><span class=n>is</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>KV</span><span class=o>.</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=n>key</span><span class=o>,</span>
</span></span><span class=line><span class=cl>          <span class=n>ImageResponse</span><span class=o>.</span><span class=na>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>setMimeType</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getMimeType</span><span class=o>())</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>setData</span><span class=o>(</span><span class=n>ByteString</span><span class=o>.</span><span class=na>copyFrom</span><span class=o>(</span><span class=n>bytes</span><span class=o>))</span>
</span></span><span class=line><span class=cl>              <span class=o>.</span><span class=na>build</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=c1>// Tells the tranform to emit immediately into failure PCollection.
</span></span></span><span class=line><span class=cl><span class=c1></span>      <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeExecutionException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h4 id=define-request>Define request</h4><p><code>ImageRequest</code> is the custom request we provide the <code>HttpImageClient</code>, defined in the example above, to invoke the HTTP call
that acquires the image.
<span class=language-java>This example happens to use <a href=https://github.com/google/auto/blob/main/value/userguide/index.md>Google AutoValue</a>,
but you can use any custom <code>Serializable</code> Java class as you would in any Beam <code>PCollection</code>,
including inherent Java classes such as <code>String</code>, <code>Double</code>, etc. For convenience, this example uses
<code>@DefaultSchema(AutoValueSchema.class)</code> allowing us to map our custom type to a
<a href=/documentation/programming-guide/#schemas>Beam Schema</a> automatically based on its getters.</span></p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/** An HTTP request for an image. */</span>
</span></span><span class=line><span class=cl><span class=nd>@DefaultSchema</span><span class=o>(</span><span class=n>AutoValueSchema</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@AutoValue</span>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ImageRequest</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=kd>final</span> <span class=n>TypeDescriptor</span><span class=o>&lt;</span><span class=n>ImageRequest</span><span class=o>&gt;</span> <span class=n>TYPE</span> <span class=o>=</span> <span class=n>TypeDescriptor</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>ImageRequest</span><span class=o>.</span><span class=na>class</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Map</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>String</span><span class=o>&gt;</span> <span class=n>EXT_MIMETYPE_MAP</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>      <span class=n>ImmutableMap</span><span class=o>.</span><span class=na>of</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=s>&#34;jpg&#34;</span><span class=o>,</span> <span class=s>&#34;image/jpeg&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>          <span class=s>&#34;jpeg&#34;</span><span class=o>,</span> <span class=s>&#34;image/jpeg&#34;</span><span class=o>,</span>
</span></span><span class=line><span class=cl>          <span class=s>&#34;png&#34;</span><span class=o>,</span> <span class=s>&#34;image/png&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/** Derive the MIME type of the image from the url based on its extension. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=n>String</span> <span class=nf>mimeTypeOf</span><span class=o>(</span><span class=n>String</span> <span class=n>url</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>ext</span> <span class=o>=</span> <span class=n>FileNameUtils</span><span class=o>.</span><span class=na>getExtension</span><span class=o>(</span><span class=n>url</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(!</span><span class=n>EXT_MIMETYPE_MAP</span><span class=o>.</span><span class=na>containsKey</span><span class=o>(</span><span class=n>ext</span><span class=o>))</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>IllegalArgumentException</span><span class=o>(</span>
</span></span><span class=line><span class=cl>          <span class=n>String</span><span class=o>.</span><span class=na>format</span><span class=o>(</span><span class=s>&#34;could not map extension to mimetype: ext %s of url: %s&#34;</span><span class=o>,</span> <span class=n>ext</span><span class=o>,</span> <span class=n>url</span><span class=o>));</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>EXT_MIMETYPE_MAP</span><span class=o>.</span><span class=na>get</span><span class=o>(</span><span class=n>ext</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>Builder</span> <span class=nf>builder</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>AutoValue_ImageRequest</span><span class=o>.</span><span class=na>Builder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/** Build an {@link ImageRequest} from a {@param url}. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>ImageRequest</span> <span class=nf>of</span><span class=o>(</span><span class=n>String</span> <span class=n>url</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>builder</span><span class=o>().</span><span class=na>setImageUrl</span><span class=o>(</span><span class=n>url</span><span class=o>).</span><span class=na>setMimeType</span><span class=o>(</span><span class=n>mimeTypeOf</span><span class=o>(</span><span class=n>url</span><span class=o>)).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/** The URL of the image request. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getImageUrl</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/** The MIME type of the image request. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getMimeType</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@AutoValue.Builder</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setImageUrl</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setMimeType</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>ImageRequest</span> <span class=nf>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h4 id=define-response>Define response</h4><p><code>ImageResponse</code> is the custom response we return from the <code>HttpImageClient</code>, defined in the example above, that contains the image data
as a result of calling the remote server with the image URL.
<span class=language-java>Again,
this example happens to use <a href=https://github.com/google/auto/blob/main/value/userguide/index.md>Google AutoValue</a>,
but you can use any custom <code>Serializable</code> Java class as you would in any Beam <code>PCollection</code>
including inherent Java classes such as <code>String</code>, <code>Double</code>, etc.</span></p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/** An HTTP response of an image request. */</span>
</span></span><span class=line><span class=cl><span class=nd>@DefaultSchema</span><span class=o>(</span><span class=n>AutoValueSchema</span><span class=o>.</span><span class=na>class</span><span class=o>)</span>
</span></span><span class=line><span class=cl><span class=nd>@AutoValue</span>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>ImageResponse</span> <span class=kd>implements</span> <span class=n>Serializable</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>Builder</span> <span class=nf>builder</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>AutoValue_ImageResponse</span><span class=o>.</span><span class=na>Builder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/** The MIME type of the response payload. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getMimeType</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=cm>/** The payload of the response containing the image data. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>ByteString</span> <span class=nf>getData</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@AutoValue.Builder</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setMimeType</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setData</span><span class=o>(</span><span class=n>ByteString</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>ImageResponse</span> <span class=nf>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h4 id=define-response-coder>Define response coder</h4><p class=language-java><code>RequestResponseIO</code> needs the response&rsquo;s
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/coders/Coder.html>Coder</a>
as its second required parameter, shown in the example below. Please see the
<a href=https://beam.apache.org/documentation/programming-guide/#data-encoding-and-type-safety>Beam Programming Guide</a>
for more information about Beam Coders.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/** A {@link CustomCoder} of an {@link ImageResponse}. */</span>
</span></span><span class=line><span class=cl><span class=kd>class</span> <span class=nc>ImageResponseCoder</span> <span class=kd>extends</span> <span class=n>CustomCoder</span><span class=o>&lt;</span><span class=n>ImageResponse</span><span class=o>&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kd>static</span> <span class=n>ImageResponseCoder</span> <span class=nf>of</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>ImageResponseCoder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Coder</span><span class=o>&lt;</span><span class=kt>byte</span><span class=o>[]&gt;</span> <span class=n>BYTE_ARRAY_CODER</span> <span class=o>=</span> <span class=n>ByteArrayCoder</span><span class=o>.</span><span class=na>of</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>static</span> <span class=kd>final</span> <span class=n>Coder</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>STRING_CODER</span> <span class=o>=</span> <span class=n>StringUtf8Coder</span><span class=o>.</span><span class=na>of</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>encode</span><span class=o>(</span><span class=n>ImageResponse</span> <span class=n>value</span><span class=o>,</span> <span class=n>OutputStream</span> <span class=n>outStream</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>CoderException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>BYTE_ARRAY_CODER</span><span class=o>.</span><span class=na>encode</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>getData</span><span class=o>().</span><span class=na>toByteArray</span><span class=o>(),</span> <span class=n>outStream</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>STRING_CODER</span><span class=o>.</span><span class=na>encode</span><span class=o>(</span><span class=n>value</span><span class=o>.</span><span class=na>getMimeType</span><span class=o>(),</span> <span class=n>outStream</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>ImageResponse</span> <span class=nf>decode</span><span class=o>(</span><span class=n>InputStream</span> <span class=n>inStream</span><span class=o>)</span> <span class=kd>throws</span> <span class=n>CoderException</span><span class=o>,</span> <span class=n>IOException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>byte</span><span class=o>[]</span> <span class=n>data</span> <span class=o>=</span> <span class=n>BYTE_ARRAY_CODER</span><span class=o>.</span><span class=na>decode</span><span class=o>(</span><span class=n>inStream</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>mimeType</span> <span class=o>=</span> <span class=n>STRING_CODER</span><span class=o>.</span><span class=na>decode</span><span class=o>(</span><span class=n>inStream</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>ImageResponse</span><span class=o>.</span><span class=na>builder</span><span class=o>().</span><span class=na>setData</span><span class=o>(</span><span class=n>ByteString</span><span class=o>.</span><span class=na>copyFrom</span><span class=o>(</span><span class=n>data</span><span class=o>)).</span><span class=na>setMimeType</span><span class=o>(</span><span class=n>mimeType</span><span class=o>).</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h4 id=acquire-image-data-from-urls>Acquire image data from URLs</h4><p>Below shows an example how to bring everything together in an end-to-end pipeline. From a list of image URLs,
the example builds the <code>PCollection</code> of <code>ImageRequest</code>s that is applied to an instantiated <code>RequestResponseIO</code>,
using the <code>HttpImageClient</code> <code>Caller</code> implementation.</p><p class=language-java>Any failures, accessible from the <code>Result</code>&rsquo;s <code>getFailures</code> getter, are outputted to logs. As already discussed above,
one could write these failures to a database or filesystem.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=cm>/** Example demonstrating downloading a list of image URLs using {@link RequestResponseIO}. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=kt>void</span> <span class=nf>readFromGetEndpointExample</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>urls</span><span class=o>,</span> <span class=n>Pipeline</span> <span class=n>pipeline</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//        Pipeline pipeline = Pipeline.create();
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//        List&lt;String&gt; urls = ImmutableList.of(
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/cake.jpg&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/chocolate.png&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/croissant.jpg&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/dog_form.jpg&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/factory.png&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/scones.jpg&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//        );
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 1: Convert the list of URLs to a PCollection of ImageRequests.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PCollection</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageRequest</span><span class=o>&gt;&gt;</span> <span class=n>requests</span> <span class=o>=</span> <span class=n>Images</span><span class=o>.</span><span class=na>requestsOf</span><span class=o>(</span><span class=n>urls</span><span class=o>,</span> <span class=n>pipeline</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 2: RequestResponseIO requires a Coder as its second parameter.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>KvCoder</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;</span> <span class=n>responseCoder</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>KvCoder</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>StringUtf8Coder</span><span class=o>.</span><span class=na>of</span><span class=o>(),</span> <span class=n>ImageResponseCoder</span><span class=o>.</span><span class=na>of</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 3: Process ImageRequests using RequestResponseIO instantiated from the Caller
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// implementation and the expected PCollection response Coder.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Result</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;&gt;</span> <span class=n>result</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>requests</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>ImageResponse</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>RequestResponseIO</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>HttpImageClient</span><span class=o>.</span><span class=na>of</span><span class=o>(),</span> <span class=n>responseCoder</span><span class=o>));</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 4: Log any failures to stderr.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>result</span><span class=o>.</span><span class=na>getFailures</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span><span class=s>&#34;logErrors&#34;</span><span class=o>,</span> <span class=n>Log</span><span class=o>.</span><span class=na>errorOf</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 5: Log output to stdout.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Images</span><span class=o>.</span><span class=na>displayOf</span><span class=o>(</span><span class=n>result</span><span class=o>.</span><span class=na>getResponses</span><span class=o>()).</span><span class=na>apply</span><span class=o>(</span><span class=s>&#34;logResponses&#34;</span><span class=o>,</span> <span class=n>Log</span><span class=o>.</span><span class=na>infoOf</span><span class=o>());</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span></span></span></code></pre></div></div></div><p>The pipeline output, shown below, displays a summary of the downloaded image, its URL, mimetype and size.</p><div class=snippet><div class="notebook-skip code-snippet without_switcher"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><pre tabindex=0><code>KV{https://storage.googleapis.com/generativeai-downloads/images/factory.png, mimeType=image/png, size=23130}
KV{https://storage.googleapis.com/generativeai-downloads/images/scones.jpg, mimeType=image/jpeg, size=394671}
KV{https://storage.googleapis.com/generativeai-downloads/images/cake.jpg, mimeType=image/jpeg, size=253809}
KV{https://storage.googleapis.com/generativeai-downloads/images/chocolate.png, mimeType=image/png, size=29375}
KV{https://storage.googleapis.com/generativeai-downloads/images/croissant.jpg, mimeType=image/jpeg, size=207281}
KV{https://storage.googleapis.com/generativeai-downloads/images/dog_form.jpg, mimeType=image/jpeg, size=1121752}</code></pre></div></div><h3 id=using-api-client-code>Using API client code</h3><p>The last example demonstrated invoking HTTP requests directly. However, there are some API services that provide
client code that one should use within the <code>Caller</code> implementation. Using client code within Beam presents
unique challenges, namely serialization. Additionally, some client code requires explicit handling in terms of
setup and teardown.</p><p class=language-java><p><code>RequestResponseIO</code> can handle an additional interface called <code>SetupTeardown</code> for these scenarios.</p><p>The <a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/io/requestresponse/SetupTeardown.html>SetupTeardown</a>
interface has only two methods, setup and teardown.</p></p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>interface</span> <span class=nc>SetupTeardown</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>setup</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span><span class=o>;</span>
</span></span><span class=line><span class=cl>    <span class=kt>void</span> <span class=nf>teardown</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span><span class=o>;</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><p class=language-java>The transform calls these setup and teardown methods within its DoFn&rsquo;s
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/transforms/DoFn.Setup.html>@Setup</a>
and
<a href=https://beam.apache.org/releases/javadoc/current/org/apache/beam/sdk/transforms/DoFn.Teardown.html>@Teardown</a>,
methods respectively.</p><p>The transform also handles retries with backoff, likewise dependent on the thrown Exception, as discussed previously
in this guide.</p><h4 id=define-caller-with-setupteardown>Define Caller with SetupTeardown</h4><p>Below is
an example that adapts
<a href=https://cloud.google.com/vertex-ai/docs/generative-ai/start/quickstarts/quickstart-multimodal>Vertex AI Gemini Java Client</a>
to work in a Beam pipeline using <code>RequestResponseIO</code>, adding usage of the <code>SetupTeardown</code> interface,
in addition to the required <code>Caller</code>. It has a bit more boilerplate than the simple HTTP example above.</p><p class=language-java><h5 id=abbreviated-snippet>Abbreviated snippet</h5><p>An abbreviated snippet showing the important parts is shown below.</p><p>The <code>setup</code> method is where the <code>GeminiAIClient</code> instantiates <code>VertexAI</code> and <code>GenerativeModel</code>, finally closing
<code>VertexAI</code> during <code>teardown</code>. Finally, its <code>call</code> method looks similar to the HTTP example above, where it takes a
request, uses it to invoke an API, and returns the response.</p></p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=kd>class</span> <span class=nc>GeminiAIClient</span> <span class=kd>implements</span>
</span></span><span class=line><span class=cl>    <span class=n>Caller</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentRequest</span><span class=o>&gt;,</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentResponse</span><span class=o>&gt;&gt;,</span>
</span></span><span class=line><span class=cl>    <span class=n>SetupTeardown</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentResponse</span><span class=o>&gt;</span> <span class=nf>call</span><span class=o>(</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentRequest</span><span class=o>&gt;</span> <span class=n>requestKV</span><span class=o>)</span>
</span></span><span class=line><span class=cl>    <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>GenerateContentResponse</span> <span class=n>response</span> <span class=o>=</span> <span class=n>client</span><span class=o>.</span><span class=na>generateContent</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getContentsList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>KV</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>requestKV</span><span class=o>.</span><span class=na>getKey</span><span class=o>(),</span> <span class=n>response</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setup</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>vertexAI</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VertexAI</span><span class=o>(</span><span class=n>getProjectId</span><span class=o>(),</span> <span class=n>getLocation</span><span class=o>());</span>
</span></span><span class=line><span class=cl>        <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenerativeModel</span><span class=o>(</span><span class=n>getModelName</span><span class=o>(),</span> <span class=n>vertexAI</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>    <span class=kd>public</span> <span class=kt>void</span> <span class=nf>teardown</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>vertexAI</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div><h5 id=full-example-1>Full example</h5><p>Below shows the full example.
Key to this example is that <code>com.google.cloud.vertexai.VertexAI</code>
and <code>com.google.cloud.vertexai.generativeai.GenerativeModel</code> are not serializable and therefore need to be
instantiated with <code>transient</code>. <em>You can ignore <code>@MonotonicNonNull</code> if your java project does not use the
<a href=https://checkerframework.org/>https://checkerframework.org/</a></em>.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm> * Example {@link Caller} and {@link SetupTeardown} implementation for use with {@link
</span></span></span><span class=line><span class=cl><span class=cm> * RequestResponseIO} to process Gemini AI {@link GenerateContentRequest}s into {@link
</span></span></span><span class=line><span class=cl><span class=cm> * GenerateContentResponse}s.
</span></span></span><span class=line><span class=cl><span class=cm> */</span>
</span></span><span class=line><span class=cl><span class=nd>@AutoValue</span>
</span></span><span class=line><span class=cl><span class=kd>abstract</span> <span class=kd>class</span> <span class=nc>GeminiAIClient</span>
</span></span><span class=line><span class=cl>    <span class=kd>implements</span> <span class=n>Caller</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentRequest</span><span class=o>&gt;,</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentResponse</span><span class=o>&gt;&gt;,</span>
</span></span><span class=line><span class=cl>        <span class=n>SetupTeardown</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>Builder</span> <span class=nf>builder</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=k>new</span> <span class=n>AutoValue_GeminiAIClient</span><span class=o>.</span><span class=na>Builder</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>MODEL_GEMINI_PRO</span> <span class=o>=</span> <span class=s>&#34;gemini-pro&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=kd>final</span> <span class=n>String</span> <span class=n>MODEL_GEMINI_PRO_VISION</span> <span class=o>=</span> <span class=s>&#34;gemini-pro-vision&#34;</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>transient</span> <span class=nd>@MonotonicNonNull</span> <span class=n>VertexAI</span> <span class=n>vertexAI</span><span class=o>;</span>
</span></span><span class=line><span class=cl>  <span class=kd>private</span> <span class=kd>transient</span> <span class=nd>@MonotonicNonNull</span> <span class=n>GenerativeModel</span> <span class=n>client</span><span class=o>;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentResponse</span><span class=o>&gt;</span> <span class=nf>call</span><span class=o>(</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentRequest</span><span class=o>&gt;</span> <span class=n>requestKV</span><span class=o>)</span>
</span></span><span class=line><span class=cl>      <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>requestKV</span><span class=o>.</span><span class=na>getKey</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=n>GenerateContentRequest</span> <span class=n>request</span> <span class=o>=</span> <span class=n>requestKV</span><span class=o>.</span><span class=na>getValue</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>request</span> <span class=o>==</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeExecutionException</span><span class=o>(</span><span class=s>&#34;request is empty&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getContentsList</span><span class=o>().</span><span class=na>isEmpty</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeExecutionException</span><span class=o>(</span><span class=s>&#34;contentsList is empty&#34;</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>try</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=n>GenerateContentResponse</span> <span class=n>response</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>          <span class=n>checkStateNotNull</span><span class=o>(</span><span class=n>client</span><span class=o>).</span><span class=na>generateContent</span><span class=o>(</span><span class=n>request</span><span class=o>.</span><span class=na>getContentsList</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>KV</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>response</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=o>}</span> <span class=k>catch</span> <span class=o>(</span><span class=n>IOException</span> <span class=n>e</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>throw</span> <span class=k>new</span> <span class=n>UserCodeExecutionException</span><span class=o>(</span><span class=n>e</span><span class=o>);</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>setup</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=n>vertexAI</span> <span class=o>=</span> <span class=k>new</span> <span class=n>VertexAI</span><span class=o>(</span><span class=n>getProjectId</span><span class=o>(),</span> <span class=n>getLocation</span><span class=o>());</span>
</span></span><span class=line><span class=cl>    <span class=n>client</span> <span class=o>=</span> <span class=k>new</span> <span class=n>GenerativeModel</span><span class=o>(</span><span class=n>getModelName</span><span class=o>(),</span> <span class=n>vertexAI</span><span class=o>);</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@Override</span>
</span></span><span class=line><span class=cl>  <span class=kd>public</span> <span class=kt>void</span> <span class=nf>teardown</span><span class=o>()</span> <span class=kd>throws</span> <span class=n>UserCodeExecutionException</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=o>(</span><span class=n>vertexAI</span> <span class=o>!=</span> <span class=kc>null</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=n>vertexAI</span><span class=o>.</span><span class=na>close</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getModelName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getProjectId</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=n>String</span> <span class=nf>getLocation</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nd>@AutoValue.Builder</span>
</span></span><span class=line><span class=cl>  <span class=kd>abstract</span> <span class=kd>static</span> <span class=kd>class</span> <span class=nc>Builder</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setModelName</span><span class=o>(</span><span class=n>String</span> <span class=n>name</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Optional</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=nf>getModelName</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setProjectId</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>Builder</span> <span class=nf>setLocation</span><span class=o>(</span><span class=n>String</span> <span class=n>value</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>abstract</span> <span class=n>GeminiAIClient</span> <span class=nf>autoBuild</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=kd>final</span> <span class=n>GeminiAIClient</span> <span class=nf>build</span><span class=o>()</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=o>(!</span><span class=n>getModelName</span><span class=o>().</span><span class=na>isPresent</span><span class=o>())</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>setModelName</span><span class=o>(</span><span class=n>MODEL_GEMINI_PRO</span><span class=o>);</span>
</span></span><span class=line><span class=cl>      <span class=o>}</span>
</span></span><span class=line><span class=cl>      <span class=k>return</span> <span class=n>autoBuild</span><span class=o>();</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span></span></span></code></pre></div></div></div><h4 id=ask-gemini-ai-to-identify-the-image>Ask Gemini AI to identify the image</h4><p>Now let&rsquo;s combine the previous example of acquiring an image to this Gemini AI client to ask it to identify the image.</p><p>Below is what we saw previously but encapsulated in a convenience method. It takes a <code>List</code> of urls, and returns
a <code>PCollection</code> of <code>ImageResponse</code>s containing the image data.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=cm>/**
</span></span></span><span class=line><span class=cl><span class=cm>   * Processes a list of raw image URLs into a {@link ImageResponse} {@link PCollection} using
</span></span></span><span class=line><span class=cl><span class=cm>   * {@link RequestResponseIO}. The resulting {@link KV#getKey} is the original image URL.
</span></span></span><span class=line><span class=cl><span class=cm>   */</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=n>Result</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;&gt;</span> <span class=nf>imagesOf</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>urls</span><span class=o>,</span> <span class=n>Pipeline</span> <span class=n>pipeline</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Coder</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;&gt;</span> <span class=n>kvCoder</span> <span class=o>=</span> <span class=n>KvCoder</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>STRING_CODER</span><span class=o>,</span> <span class=n>ImageResponseCoder</span><span class=o>.</span><span class=na>of</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>requestsOf</span><span class=o>(</span><span class=n>urls</span><span class=o>,</span> <span class=n>pipeline</span><span class=o>)</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>apply</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>ImageResponse</span><span class=o>.</span><span class=na>class</span><span class=o>.</span><span class=na>getSimpleName</span><span class=o>(),</span>
</span></span><span class=line><span class=cl>            <span class=n>RequestResponseIO</span><span class=o>.</span><span class=na>of</span><span class=o>(</span><span class=n>HttpImageClient</span><span class=o>.</span><span class=na>of</span><span class=o>(),</span> <span class=n>kvCoder</span><span class=o>));</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span></span></span></code></pre></div></div></div><p>Next we convert the <code>ImageResponse</code>s into a <code>PCollection</code> of <code>GenerateContentRequest</code>s.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>    <span class=c1>// PCollection&lt;KV&lt;Struct, ImageResponse&gt;&gt; imagesKV = ...
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>imagesKV</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>apply</span><span class=o>(</span>
</span></span><span class=line><span class=cl>            <span class=n>stepName</span><span class=o>,</span>
</span></span><span class=line><span class=cl>            <span class=n>MapElements</span><span class=o>.</span><span class=na>into</span><span class=o>(</span><span class=n>requestKVType</span><span class=o>)</span>
</span></span><span class=line><span class=cl>                <span class=o>.</span><span class=na>via</span><span class=o>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>kv</span> <span class=o>-&gt;</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>                      <span class=n>String</span> <span class=n>key</span> <span class=o>=</span> <span class=n>kv</span><span class=o>.</span><span class=na>getKey</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                      <span class=n>ImageResponse</span> <span class=n>safeResponse</span> <span class=o>=</span> <span class=n>checkStateNotNull</span><span class=o>(</span><span class=n>kv</span><span class=o>.</span><span class=na>getValue</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                      <span class=n>ByteString</span> <span class=n>data</span> <span class=o>=</span> <span class=n>safeResponse</span><span class=o>.</span><span class=na>getData</span><span class=o>();</span>
</span></span><span class=line><span class=cl>                      <span class=k>return</span> <span class=n>buildAIRequest</span><span class=o>(</span><span class=n>key</span><span class=o>,</span> <span class=n>prompt</span><span class=o>,</span> <span class=n>data</span><span class=o>,</span> <span class=n>safeResponse</span><span class=o>.</span><span class=na>getMimeType</span><span class=o>());</span>
</span></span><span class=line><span class=cl>                    <span class=o>}))</span>
</span></span><span class=line><span class=cl>        <span class=o>.</span><span class=na>setCoder</span><span class=o>(</span><span class=n>kvCoder</span><span class=o>);</span></span></span></code></pre></div></div></div><p class=language-java>Finally, we apply the <code>PCollection</code> of <code>GenerateContentRequest</code>s to <code>RequestResponseIO</code>, instantiated using the
<code>GeminiAIClient</code>, defined above. Notice instead of <code>RequestResponseIO.of</code>, we are using
<code>RequestResponseIO.ofCallerAndSetupTeardown</code>. The <code>ofCallerAndSetupTeardown</code> method just tells the compiler that we are
providing an implementation of both the <code>Caller</code> and <code>SetupTeardown</code> interfaces.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>    <span class=c1>//    PCollection&lt;KV&lt;Struct, GenerateContentRequest&gt;&gt; requestKV = ...
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//    GeminiAIClient client =
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//            GeminiAIClient.builder()
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                    .setProjectId(options.getProject())
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                    .setLocation(options.getLocation())
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                    .setModelName(MODEL_GEMINI_PRO_VISION)
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                    .build();
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>return</span> <span class=n>requestKV</span><span class=o>.</span><span class=na>apply</span><span class=o>(</span>
</span></span><span class=line><span class=cl>        <span class=s>&#34;Ask Gemini AI&#34;</span><span class=o>,</span> <span class=n>RequestResponseIO</span><span class=o>.</span><span class=na>ofCallerAndSetupTeardown</span><span class=o>(</span><span class=n>client</span><span class=o>,</span> <span class=n>responseCoder</span><span class=o>));</span></span></span></code></pre></div></div></div><p>The full end-to-end pipeline is shown below.</p><div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl>  <span class=cm>/** Demonstrates using Gemini AI to identify a images, acquired from their URLs. */</span>
</span></span><span class=line><span class=cl>  <span class=kd>static</span> <span class=kt>void</span> <span class=nf>whatIsThisImage</span><span class=o>(</span><span class=n>List</span><span class=o>&lt;</span><span class=n>String</span><span class=o>&gt;</span> <span class=n>urls</span><span class=o>,</span> <span class=n>GeminiAIOptions</span> <span class=n>options</span><span class=o>)</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=c1>//        GeminiAIOptions options = PipelineOptionsFactory.create().as(GeminiAIOptions.class);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//        options.setLocation(&#34;us-central1&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//        options.setProjectId(&#34;your-google-cloud-project-id&#34;);
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//        List&lt;String&gt; urls = ImmutableList.of(
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/cake.jpg&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/chocolate.png&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/croissant.jpg&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/dog_form.jpg&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/factory.png&#34;,
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//                &#34;https://storage.googleapis.com/generativeai-downloads/images/scones.jpg&#34;
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>//        );
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 1: Instantiate GeminiAIClient, the Caller and SetupTeardown implementation.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>GeminiAIClient</span> <span class=n>client</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>GeminiAIClient</span><span class=o>.</span><span class=na>builder</span><span class=o>()</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setProjectId</span><span class=o>(</span><span class=n>options</span><span class=o>.</span><span class=na>getProject</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setLocation</span><span class=o>(</span><span class=n>options</span><span class=o>.</span><span class=na>getLocation</span><span class=o>())</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>setModelName</span><span class=o>(</span><span class=n>MODEL_GEMINI_PRO_VISION</span><span class=o>)</span>
</span></span><span class=line><span class=cl>            <span class=o>.</span><span class=na>build</span><span class=o>();</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>Pipeline</span> <span class=n>pipeline</span> <span class=o>=</span> <span class=n>Pipeline</span><span class=o>.</span><span class=na>create</span><span class=o>(</span><span class=n>options</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 2: Download the images from the list of urls.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Result</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>ImageResponse</span><span class=o>&gt;&gt;</span> <span class=n>getImagesResult</span> <span class=o>=</span> <span class=n>Images</span><span class=o>.</span><span class=na>imagesOf</span><span class=o>(</span><span class=n>urls</span><span class=o>,</span> <span class=n>pipeline</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 3: Log any image download errors.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>getImagesResult</span><span class=o>.</span><span class=na>getFailures</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span><span class=s>&#34;Log get images errors&#34;</span><span class=o>,</span> <span class=n>Log</span><span class=o>.</span><span class=na>errorOf</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 4: Build Gemini AI requests from the download image data with the prompt &#39;What is this
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// picture?&#39;.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>PCollection</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentRequest</span><span class=o>&gt;&gt;</span> <span class=n>requests</span> <span class=o>=</span>
</span></span><span class=line><span class=cl>        <span class=n>buildAIRequests</span><span class=o>(</span><span class=s>&#34;Identify Image&#34;</span><span class=o>,</span> <span class=s>&#34;What is this picture?&#34;</span><span class=o>,</span> <span class=n>getImagesResult</span><span class=o>.</span><span class=na>getResponses</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 5: Using RequestResponseIO, ask Gemini AI &#39;What is this picture?&#39; for each downloaded
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=c1>// image.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>Result</span><span class=o>&lt;</span><span class=n>KV</span><span class=o>&lt;</span><span class=n>String</span><span class=o>,</span> <span class=n>GenerateContentResponse</span><span class=o>&gt;&gt;</span> <span class=n>responses</span> <span class=o>=</span> <span class=n>askAI</span><span class=o>(</span><span class=n>client</span><span class=o>,</span> <span class=n>requests</span><span class=o>);</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 6: Log any Gemini AI errors.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>responses</span><span class=o>.</span><span class=na>getFailures</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span><span class=s>&#34;Log AI errors&#34;</span><span class=o>,</span> <span class=n>Log</span><span class=o>.</span><span class=na>errorOf</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// Step 7: Log the result of Gemini AI&#39;s image recognition.
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>responses</span><span class=o>.</span><span class=na>getResponses</span><span class=o>().</span><span class=na>apply</span><span class=o>(</span><span class=s>&#34;Log AI answers&#34;</span><span class=o>,</span> <span class=n>Log</span><span class=o>.</span><span class=na>infoOf</span><span class=o>());</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>pipeline</span><span class=o>.</span><span class=na>run</span><span class=o>();</span>
</span></span><span class=line><span class=cl>  <span class=o>}</span></span></span></code></pre></div></div></div><p>Below shows an abbreviated output of running the full pipeline, where we see the result of Gemini AI identifying the images.<div class='language-java snippet'><div class="notebook-skip code-snippet"><a class=copy type=button data-bs-toggle=tooltip data-bs-placement=bottom title="Copy to clipboard"><img src=/images/copy-icon.svg></a><div class=highlight><pre tabindex=0 class=chroma><code class=language-java data-lang=java><span class=line><span class=cl><span class=n>KV</span><span class=o>{</span><span class=n>https</span><span class=o>:</span><span class=c1>//storage.googleapis.com/generativeai-downloads/images/chocolate.png, candidates {
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>content</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>role</span><span class=o>:</span> <span class=s>&#34;model&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span><span class=o>:</span> <span class=s>&#34; This is a picture of a chocolate bar.&#34;</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>KV</span><span class=o>{</span><span class=n>https</span><span class=o>:</span><span class=c1>//storage.googleapis.com/generativeai-downloads/images/dog_form.jpg, candidates {
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>content</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>role</span><span class=o>:</span> <span class=s>&#34;model&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span><span class=o>:</span> <span class=s>&#34; The picture is a dog walking application form. It has two sections, one for information
</span></span></span><span class=line><span class=cl><span class=s>                    about the dog and one for information about the owner. The dog\&#39;s name is Fido,
</span></span></span><span class=line><span class=cl><span class=s>                    he is a Cavoodle, and he is black and tan. He is 3 years old and has a friendly
</span></span></span><span class=line><span class=cl><span class=s>                    temperament. The owner\&#39;s name is Mark, and his phone number is 0491570006. He would
</span></span></span><span class=line><span class=cl><span class=s>                    like Fido to be walked once a week on Tuesdays and Thursdays in the morning.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>KV</span><span class=o>{</span><span class=n>https</span><span class=o>:</span><span class=c1>//storage.googleapis.com/generativeai-downloads/images/croissant.jpg
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=n>content</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=n>role</span><span class=o>:</span> <span class=s>&#34;model&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>parts</span> <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span><span class=o>:</span> <span class=s>&#34; The picture shows a basket of croissants. Croissants are a type of pastry that is made
</span></span></span><span class=line><span class=cl><span class=s>                    from a yeast-based dough that is rolled and folded several times in the rising process.
</span></span></span><span class=line><span class=cl><span class=s>                    The result is a light, flaky pastry that is often served with butter, jam, or chocolate.
</span></span></span><span class=line><span class=cl><span class=s>                    Croissants are a popular breakfast food and can also be used as a dessert or snack.&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span></span></span></code></pre></div></div></div></p><div class=feedback><p class=update>Last updated on 2024/10/22</p><h3>Have you found everything you were looking for?</h3><p class=description>Was it all useful and clear? Is there anything that you would like to change? Let us know!</p><button class=load-button><a href="https://docs.google.com/forms/d/e/1FAIpQLSfID7abne3GE6k6RdJIyZhPz2Gef7UkpggUEhTIDjjplHuxSA/viewform?usp=header_link" target=_blank>SEND FEEDBACK</a></button></div></div></div><footer class=footer><div class=footer__contained><div class=footer__cols><div class="footer__cols__col footer__cols__col__logos"><div class=footer__cols__col__logo><img src=/images/beam_logo_circle.svg class=footer__logo alt="Beam logo"></div><div class=footer__cols__col__logo><img src=/images/apache_logo_circle.svg class=footer__logo alt="Apache logo"></div></div><div class=footer-wrapper><div class=wrapper-grid><div class=footer__cols__col><div class=footer__cols__col__title>Start</div><div class=footer__cols__col__link><a href=/get-started/beam-overview/>Overview</a></div><div class=footer__cols__col__link><a href=/get-started/quickstart-java/>Quickstart (Java)</a></div><div class=footer__cols__col__link><a href=/get-started/quickstart-py/>Quickstart (Python)</a></div><div class=footer__cols__col__link><a href=/get-started/quickstart-go/>Quickstart (Go)</a></div><div class=footer__cols__col__link><a href=/get-started/downloads/>Downloads</a></div></div><div class=footer__cols__col><div class=footer__cols__col__title>Docs</div><div class=footer__cols__col__link><a href=/documentation/programming-guide/>Concepts</a></div><div class=footer__cols__col__link><a href=/documentation/pipelines/design-your-pipeline/>Pipelines</a></div><div class=footer__cols__col__link><a href=/documentation/runners/capability-matrix/>Runners</a></div></div><div class=footer__cols__col><div class=footer__cols__col__title>Community</div><div class=footer__cols__col__link><a href=/contribute/>Contribute</a></div><div class=footer__cols__col__link><a href=https://projects.apache.org/committee.html?beam target=_blank>Team<img src=/images/external-link-icon.png width=14 height=14 alt="External link."></a></div><div class=footer__cols__col__link><a href=/community/presentation-materials/>Media</a></div><div class=footer__cols__col__link><a href=/community/in-person/>Events/Meetups</a></div><div class=footer__cols__col__link><a href=/community/contact-us/>Contact Us</a></div></div><div class=footer__cols__col><div class=footer__cols__col__title>Resources</div><div class=footer__cols__col__link><a href=/blog/>Blog</a></div><div class=footer__cols__col__link><a href=https://github.com/apache/beam>GitHub</a></div></div></div><div class=footer__bottom>&copy;
<a href=https://www.apache.org>The Apache Software Foundation</a>
| <a href=/privacy_policy>Privacy Policy</a>
| <a href=/feed.xml>RSS Feed</a><br><br>Apache Beam, Apache, Beam, the Beam logo, and the Apache feather logo are either registered trademarks or trademarks of The Apache Software Foundation. All other products or name brands are trademarks of their respective holders, including The Apache Software Foundation.</div></div><div class="footer__cols__col footer__cols__col__logos"><div class=footer__cols__col--group><div class=footer__cols__col__logo><a href=https://github.com/apache/beam><img src=/images/logos/social-icons/github-logo-150.png class=footer__logo alt="Github logo"></a></div><div class=footer__cols__col__logo><a href=https://www.linkedin.com/company/apache-beam/><img src=/images/logos/social-icons/linkedin-logo-150.png class=footer__logo alt="Linkedin logo"></a></div></div><div class=footer__cols__col--group><div class=footer__cols__col__logo><a href=https://twitter.com/apachebeam><img src=/images/logos/social-icons/twitter-logo-150.png class=footer__logo alt="Twitter logo"></a></div><div class=footer__cols__col__logo><a href=https://www.youtube.com/channel/UChNnb_YO_7B0HlW6FhAXZZQ><img src=/images/logos/social-icons/youtube-logo-150.png class=footer__logo alt="Youtube logo"></a></div></div></div></div></div></footer></body></html>