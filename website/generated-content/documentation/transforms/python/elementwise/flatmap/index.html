<!DOCTYPE html>
<!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<html lang="en">
  <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>FlatMap</title>
  <meta name="description" content="Apache Beam is an open source, unified model and set of language-specific SDKs for defining and executing data processing workflows, and also data ingestion and integration flows, supporting Enterprise Integration Patterns (EIPs) and Domain Specific Languages (DSLs). Dataflow pipelines simplify the mechanics of large-scale batch and streaming data processing and can run on a number of runtimes like Apache Flink, Apache Spark, and Google Cloud Dataflow (a cloud service). Beam also brings DSL in different languages, allowing users to easily implement their data integration processes.
">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">
  <link rel="stylesheet" href="/css/site.css">
  <script src="https://code.jquery.com/jquery-2.2.4.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/language-switch.js"></script>
  <script src="/js/fix-menu.js"></script>
  <script src="/js/section-nav.js"></script>
  <script src="/js/page-nav.js"></script>
  <link rel="canonical" href="https://beam.apache.org/documentation/transforms/python/elementwise/flatmap/" data-proofer-ignore>
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Apache Beam" href="https://beam.apache.org/feed.xml">
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.4.1/css/all.css" integrity="sha384-5sAR7xN1Nv6T6+dT2mhtzEpVJvfS3NScPQTrOxhwjIuvcA67KV2R5Jz6kr4abQsz" crossorigin="anonymous">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-73650088-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body class="body" data-spy="scroll" data-target=".page-nav" data-offset="0">
    <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<nav class="header navbar navbar-fixed-top">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>

      <a href="/" class="navbar-brand" >
        <img alt="Brand" style="height: 25px" src="/images/beam_logo_navbar.png">
      </a>
    </div>

    <div class="navbar-mask closed"></div>

    <div id="navbar" class="navbar-container closed">
      <ul class="nav navbar-nav">
        <li>
          <a href="/get-started/beam-overview/">Get Started</a>
        </li>
        <li>
          <a href="/documentation/">Documentation</a>
        </li>
        <li>
          <a href="/documentation/sdks/java/">Languages</a>
        </li>
        <li>
          <a href="/documentation/runners/capability-matrix/">RUNNERS</a>
        </li>
        <li>
          <a href="/roadmap/">Roadmap</a>
        </li>
        <li>
          <a href="/contribute/">Contribute</a>
        </li>
        <li>
          <a href="/community/contact-us/">Community</a>
        </li>
        <li><a href="/blog">Blog</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
          <div style="width: 300px;">
            <script>
              (function() {
                var cx = '012923275103528129024:4emlchv9wzi';
                var gcse = document.createElement('script');
                gcse.type = 'text/javascript';
                gcse.async = true;
                gcse.src = 'https://cse.google.com/cse.js?cx=' + cx;
                var s = document.getElementsByTagName('script')[0];
                s.parentNode.insertBefore(gcse, s);
              })();
            </script>
            <gcse:search></gcse:search>
          </div>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="https://www.apache.org/foundation/press/kit/feather_small.png" alt="Apache Logo" style="height:20px;"><span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="http://www.apache.org/">ASF Homepage</a></li>
            <li><a href="http://www.apache.org/licenses/">License</a></li>
            <li><a href="http://www.apache.org/security/">Security</a></li>
            <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
          </ul>
        </li>
        <li>
          <!--
            data-proofer-ignore disables link checking from website test automation.
            GitHub links will not resolve until the markdown source is available on the master branch.
            New pages would fail validation during development / PR test automation.
          -->
          <a href="https://github.com/apache/beam/edit/master/website/src/documentation/transforms/python/element-wise/flatmap.md" data-proofer-ignore>
            <i class="far fa-edit fa-lg" alt="Edit on GitHub" title="Edit on GitHub"></i>
          </a>
        </li>
      </ul>
    </div>
</nav>

    <div class="clearfix container-main-content">
      <div class="section-nav closed" data-offset-top="90" data-offset-bottom="500">
        <span class="section-nav-back glyphicon glyphicon-menu-left"></span>
        <nav>
          <ul class="section-nav-list" data-section-nav>
            <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<li><span class="section-nav-list-main-title">Documentation</span></li>
<li><a href="/documentation">Using the Documentation</a></li>
<li><a href="/documentation/execution-model">Beam Execution Model</a></li>
<li>
  <span class="section-nav-list-title">Pipeline development lifecycle</span>

  <ul class="section-nav-list">
    <li><a href="/documentation/pipelines/design-your-pipeline/">Design Your Pipeline</a></li>
    <li><a href="/documentation/pipelines/create-your-pipeline/">Create Your Pipeline</a></li>
    <li><a href="/documentation/pipelines/test-your-pipeline/">Test Your Pipeline</a></li>
  </ul>
</li>
<li>
  <span class="section-nav-list-title">Beam programming guide</span>

  <ul class="section-nav-list">
    <li><a href="/documentation/programming-guide/">Overview</a></li>
    <li><a href="/documentation/programming-guide/#creating-a-pipeline">Pipelines</a></li>
    <li class="section-nav-item--collapsible">
      <span class="section-nav-list-title">PCollections</span>

      <ul class="section-nav-list">
        <li><a href="/documentation/programming-guide/#pcollections">Creating a PCollection</a></li>
        <li><a href="/documentation/programming-guide/#pcollection-characteristics">PCollection characteristics</a></li>
      </ul>
    </li>
    <li class="section-nav-item--collapsible">
      <span class="section-nav-list-title">Transforms</span>

      <ul class="section-nav-list">
        <li><a href="/documentation/programming-guide/#applying-transforms">Applying transforms</a></li>
        <li>
          <span class="section-nav-list-title">Core Beam transforms</span>

          <ul class="section-nav-list">
            <li><a href="/documentation/programming-guide/#pardo">ParDo</a></li>
            <li><a href="/documentation/programming-guide/#groupbykey">GroupByKey</a></li>
            <li><a href="/documentation/programming-guide/#cogroupbykey">CoGroupByKey</a></li>
            <li><a href="/documentation/programming-guide/#combine">Combine</a></li>
            <li><a href="/documentation/programming-guide/#flatten">Flatten</a></li>
            <li><a href="/documentation/programming-guide/#partition">Partition</a></li>
          </ul>
        </li>

        <li><a href="/documentation/programming-guide/#requirements-for-writing-user-code-for-beam-transforms">Requirements for user code</a></li>
        <li><a href="/documentation/programming-guide/#side-inputs">Side inputs</a></li>
        <li><a href="/documentation/programming-guide/#additional-outputs">Additional outputs</a></li>
        <li><a href="/documentation/programming-guide/#composite-transforms">Composite transforms</a></li>
      </ul>
    </li>
    <li class="section-nav-item--collapsible">
      <span class="section-nav-list-title">Pipeline I/O</span>

      <ul class="section-nav-list">
        <li><a href="/documentation/programming-guide/#pipeline-io">Using I/O transforms</a></li>
        <li><a href="/documentation/io/built-in/">Built-in I/O connectors</a></li>

        <li class="section-nav-item--collapsible">
           <span class="section-nav-list-title">Developing new I/O connectors</span>

          <ul class="section-nav-list">
           <li><a href="/documentation/io/developing-io-overview/">Overview: Developing connectors</a></li>
           <li><a href="/documentation/io/developing-io-java/">Developing connectors (Java)</a></li>
           <li><a href="/documentation/io/developing-io-python/">Developing connectors (Python)</a></li>
          </ul>
        </li>

        <li><a href="/documentation/io/testing/">Testing I/O transforms</a></li>
      </ul>
    </li>
    <li class="section-nav-item--collapsible">
      <span class="section-nav-list-title">Data encoding and type safety</span>

      <ul class="section-nav-list">
        <li><a href="/documentation/programming-guide/#data-encoding-and-type-safety">Data encoding basics</a></li>
        <li><a href="/documentation/programming-guide/#specifying-coders">Specifying coders</a></li>
        <li><a href="/documentation/programming-guide/#default-coders-and-the-coderregistry">Default coders and the CoderRegistry</a></li>
      </ul>
    </li>
    <li class="section-nav-item--collapsible">
      <span class="section-nav-list-title">Windowing</span>

      <ul class="section-nav-list">
        <li><a href="/documentation/programming-guide/#windowing">Windowing basics</a></li>
        <li><a href="/documentation/programming-guide/#provided-windowing-functions">Provided windowing functions</a></li>
        <li><a href="/documentation/programming-guide/#setting-your-pcollections-windowing-function">Setting your PCollectionâ€™s windowing function</a></li>
        <li><a href="/documentation/programming-guide/#watermarks-and-late-data">Watermarks and late data</a></li>
        <li><a href="/documentation/programming-guide/#adding-timestamps-to-a-pcollections-elements">Adding timestamps to a PCollectionâ€™s elements</a></li>
      </ul>
    </li>
    <li class="section-nav-item--collapsible">
      <span class="section-nav-list-title">Triggers</span>

      <ul class="section-nav-list">
        <li><a href="/documentation/programming-guide/#triggers">Trigger basics</a></li>
        <li><a href="/documentation/programming-guide/#event-time-triggers">Event time triggers and the default trigger</a></li>
        <li><a href="/documentation/programming-guide/#processing-time-triggers">Processing time triggers</a></li>
        <li><a href="/documentation/programming-guide/#data-driven-triggers">Data-driven triggers</a></li>
        <li><a href="/documentation/programming-guide/#setting-a-trigger">Setting a trigger</a></li>
        <li><a href="/documentation/programming-guide/#composite-triggers">Composite triggers</a></li>
      </ul>
    </li>
  </ul>
</li>

<li class="section-nav-item--collapsible">
  <span class="section-nav-list-title">Transform catalog</span>

  <ul class="section-nav-list">
  <li class="section-nav-item--collapsible">
    <span class="section-nav-list-title">Python</span>

    <ul class="section-nav-list">
      <li><a href="/documentation/transforms/python/overview/">Overview</a></li>
      <li class="section-nav-item--collapsible">
        <span class="section-nav-list-title">Element-wise</span>

        <ul class="section-nav-list">
          <li><a href="/documentation/transforms/python/elementwise/filter/">Filter</a></li>
          <li><a href="/documentation/transforms/python/elementwise/flatmap/">FlatMap</a></li>  
          <li><a href="/documentation/transforms/python/elementwise/keys/">Keys</a></li>
          <li><a href="/documentation/transforms/python/elementwise/kvswap/">KvSwap</a></li> 
          <li><a href="/documentation/transforms/python/elementwise/map/">Map</a></li>
          <li><a href="/documentation/transforms/python/elementwise/pardo/">ParDo</a></li>   
          <li><a href="/documentation/transforms/python/elementwise/partition/">Partition</a></li>
          <li><a href="/documentation/transforms/python/elementwise/regex/">Regex</a></li>
          <li><a href="/documentation/transforms/python/elementwise/reify/">Reify</a></li>
          <li><a href="/documentation/transforms/python/elementwise/tostring/">ToString</a></li>
          <li><a href="/documentation/transforms/python/elementwise/values/">Values</a></li>          
          <li><a href="/documentation/transforms/python/elementwise/withtimestamps/">WithTimestamps</a></li>                                              
        </ul>
      </li>
      <li class="section-nav-item--collapsible">
        <span class="section-nav-list-title">Aggregation</span>

        <ul class="section-nav-list">
          <li><a href="/documentation/transforms/python/aggregation/cogroupbykey/">CoGroupByKey</a></li>
          <li><a href="/documentation/transforms/python/aggregation/combineglobally/">CombineGlobally</a></li>
          <li><a href="/documentation/transforms/python/aggregation/count/">Count</a></li>
          <li><a href="/documentation/transforms/python/aggregation/distinct/">Distinct</a></li>
          <li><a href="/documentation/transforms/python/aggregation/groupbykey/">GroupByKey</a></li>
          <li><a href="/documentation/transforms/python/aggregation/mean/">Mean</a></li>
          <li><a href="/documentation/transforms/python/aggregation/sample/">Sample</a></li>
          <li><a href="/documentation/transforms/python/aggregation/top/">Top</a></li>
        </ul>
      </li>
      <li class="section-nav-item--collapsible">
        <span class="section-nav-list-title">Other</span>

        <ul class="section-nav-list">
          <li><a href="/documentation/transforms/python/other/create/">Create</a></li>
          <li><a href="/documentation/transforms/python/other/flatten/">Flatten</a></li>
          <li><a href="/documentation/transforms/python/other/reshuffle/">Reshuffle</a></li>
          <li><a href="/documentation/transforms/python/other/windowinto/">WindowInto</a></li>
        </ul>
      </li>
    </ul>
  </li>   

  <li class="section-nav-item--collapsible">
    <span class="section-nav-list-title">Java</span>

    <ul class="section-nav-list">
      <li><a href="/documentation/transforms/java/overview/">Overview</a></li>
      <li class="section-nav-item--collapsible">
        <span class="section-nav-list-title">Element-wise</span>

        <ul class="section-nav-list">
          <li><a href="/documentation/transforms/java/elementwise/filter/">Filter</a></li>
          <li><a href="/documentation/transforms/java/elementwise/flatmapelements/">FlatMapElements</a></li>  
          <li><a href="/documentation/transforms/java/elementwise/keys/">Keys</a></li>
          <li><a href="/documentation/transforms/java/elementwise/kvswap/">KvSwap</a></li> 
          <li><a href="/documentation/transforms/java/elementwise/mapelements/">MapElements</a></li>
          <li><a href="/documentation/transforms/java/elementwise/pardo/">ParDo</a></li>   
          <li><a href="/documentation/transforms/java/elementwise/partition/">Partition</a></li>
          <li><a href="/documentation/transforms/java/elementwise/regex/">Regex</a></li>
          <li><a href="/documentation/transforms/java/elementwise/reify/">Reify</a></li>
          <li><a href="/documentation/transforms/java/elementwise/values/">Values</a></li>           
          <li><a href="/documentation/transforms/java/elementwise/tostring/">ToString</a></li>
          <li><a href="/documentation/transforms/java/elementwise/withkeys/">WithKeys</a></li> 
          <li><a href="/documentation/transforms/java/elementwise/withtimestamps/">WithTimestamps</a></li>                                             
        </ul>
      </li>
      <li class="section-nav-item--collapsible">
        <span class="section-nav-list-title">Aggregation</span>

        <ul class="section-nav-list">
          <li><a href="/documentation/transforms/java/aggregation/approximatequantiles/">ApproximateQuantiles</a></li>
          <li><a href="/documentation/transforms/java/aggregation/approximateunique/">ApproximateUnique</a></li>
          <li><a href="/documentation/transforms/java/aggregation/cogroupbykey/">CoGroupByKey</a></li>
          <li><a href="/documentation/transforms/java/aggregation/combine/">Combine</a></li>
          <li><a href="/documentation/transforms/java/aggregation/combinewithcontext/">CombineWithContext</a></li>
          <li><a href="/documentation/transforms/java/aggregation/count/">Count</a></li>
          <li><a href="/documentation/transforms/java/aggregation/distinct/">Distinct</a></li>
          <li><a href="/documentation/transforms/java/aggregation/groupbykey/">GroupByKey</a></li>
          <li><a href="/documentation/transforms/java/aggregation/groupintobatches/">GroupIntoBatches</a></li>
          <li><a href="/documentation/transforms/java/aggregation/latest/">Latest</a></li>
          <li><a href="/documentation/transforms/java/aggregation/max/">Max</a></li>
          <li><a href="/documentation/transforms/java/aggregation/mean/">Mean</a></li>
          <li><a href="/documentation/transforms/java/aggregation/min/">Min</a></li>
          <li><a href="/documentation/transforms/java/aggregation/sample/">Sample</a></li>
          <li><a href="/documentation/transforms/java/aggregation/sum/">Sum</a></li>
          <li><a href="/documentation/transforms/java/aggregation/top/">Top</a></li>
        </ul>
      </li>
      <li class="section-nav-item--collapsible">
        <span class="section-nav-list-title">Other</span>

        <ul class="section-nav-list">
          <li><a href="/documentation/transforms/java/other/create/">Create</a></li>
          <li><a href="/documentation/transforms/java/other/flatten/">Flatten</a></li>
          <li><a href="/documentation/transforms/java/other/passert/">PAssert</a></li>
          <li><a href="/documentation/transforms/java/other/view/">View</a></li>
          <li><a href="/documentation/transforms/java/other/window/">Window</a></li>
        </ul>
      </li>
    </ul>
  </li>   
  </ul>

</li>

<li class="section-nav-item--collapsible">
  <span class="section-nav-list-title">Common pipeline patterns</span>

  <ul class="section-nav-list">
    <li><a href="/documentation/patterns/overview/">Overview</a></li>
    <li><a href="/documentation/patterns/file-processing-patterns/">File processing patterns</a></li>
    <li><a href="/documentation/patterns/side-input-patterns/">Side input patterns</a></li>
    <li><a href="/documentation/patterns/pipeline-option-patterns/">Pipeline option patterns</a></li>
    <li><a href="/documentation/patterns/custom-io-patterns/">Custom I/O patterns</a></li>
  </ul>
</li>

<li class="section-nav-item--collapsible">
  <span class="section-nav-list-title">Learning resources</span>

  <ul class="section-nav-list">
    <li><a href="/documentation/resources/learning-resources/#getting-started">Getting Started</a></li>
    <li><a href="/documentation/resources/learning-resources/#articles">Articles</a></li>
    <li><a href="/documentation/resources/learning-resources/#interactive-labs">Interactive Labs</a></li>
    <li><a href="/documentation/resources/learning-resources/#beam-katas">Beam Katas</a></li>
    <li><a href="/documentation/resources/learning-resources/#code-examples">Code Examples</a></li>
    <li><a href="/documentation/resources/learning-resources/#api-reference">API Reference</a></li>
    <li><a href="/documentation/resources/learning-resources/#feedback-and-suggestions">Feedback and Suggestions</a></li>
    <li><a href="/documentation/resources/learning-resources/#how-to-contribute">How to Contribute</a></li>
    <li><a href="/documentation/resources/videos-and-podcasts">Videos and Podcasts</a></li>
  </ul>
</li>
<li><a href="https://cwiki.apache.org/confluence/display/BEAM/Apache+Beam">Beam Wiki</a></li>

          </ul>
        </nav>
      </div>

      <nav class="page-nav clearfix" data-offset-top="90" data-offset-bottom="500">
        <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->



<ul class="nav">
  <li><a href="#examples">Examples</a>
    <ul>
      <li><a href="#example-1-flatmap-with-a-predefined-function">Example 1: FlatMap with a predefined function</a></li>
      <li><a href="#example-2-flatmap-with-a-function">Example 2: FlatMap with a function</a></li>
      <li><a href="#example-3-flatmap-with-a-lambda-function">Example 3: FlatMap with a lambda function</a></li>
      <li><a href="#example-4-flatmap-with-a-generator">Example 4: FlatMap with a generator</a></li>
      <li><a href="#example-5-flatmaptuple-for-key-value-pairs">Example 5: FlatMapTuple for key-value pairs</a></li>
      <li><a href="#example-6-flatmap-with-multiple-arguments">Example 6: FlatMap with multiple arguments</a></li>
      <li><a href="#example-7-flatmap-with-side-inputs-as-singletons">Example 7: FlatMap with side inputs as singletons</a></li>
      <li><a href="#example-8-flatmap-with-side-inputs-as-iterators">Example 8: FlatMap with side inputs as iterators</a></li>
      <li><a href="#example-9-flatmap-with-side-inputs-as-dictionaries">Example 9: FlatMap with side inputs as dictionaries</a></li>
    </ul>
  </li>
  <li><a href="#related-transforms">Related transforms</a></li>
</ul>


      </nav>

      <div class="body__contained body__section-nav">
        <!--
Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License.
-->

<h1 id="flatmap">FlatMap</h1>

<script type="text/javascript">
localStorage.setItem('language', 'language-py')
</script>

<table>
  <td>
    <a class="button" target="_blank" href="https://beam.apache.org/releases/pydoc/current/apache_beam.transforms.core.html#apache_beam.transforms.core.FlatMap">
      <img src="https://beam.apache.org/images/logos/sdks/python.png" width="20px" height="20px" alt="Pydoc" />
      Pydoc
    </a>
  </td>
</table>
<p><br /></p>

<p>Applies a simple 1-to-many mapping function over each element in the collection.
The many elements are flattened into the resulting collection.</p>

<h2 id="examples">Examples</h2>

<p>In the following examples, we create a pipeline with a <code class="highlighter-rouge">PCollection</code> of produce with their icon, name, and duration.
Then, we apply <code class="highlighter-rouge">FlatMap</code> in multiple ways to yield zero or more elements per each input element into the resulting <code class="highlighter-rouge">PCollection</code>.</p>

<p><code class="highlighter-rouge">FlatMap</code> accepts a function that returns an <code class="highlighter-rouge">iterable</code>,
where each of the output <code class="highlighter-rouge">iterable</code>â€™s elements is an element of the resulting <code class="highlighter-rouge">PCollection</code>.</p>

<h3 id="example-1-flatmap-with-a-predefined-function">Example 1: FlatMap with a predefined function</h3>

<p>We use the function <code class="highlighter-rouge">str.split</code> which takes a single <code class="highlighter-rouge">str</code> element and outputs a <code class="highlighter-rouge">list</code> of <code class="highlighter-rouge">str</code>s.
This pipeline splits the input element using whitespaces, creating a list of zero or more elements.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="s">'ğŸ“Strawberry ğŸ¥•Carrot ğŸ†Eggplant'</span><span class="p">,</span>
          <span class="s">'ğŸ…Tomato ğŸ¥”Potato'</span><span class="p">,</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Split words'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span><span class="nb">str</span><span class="o">.</span><span class="n">split</span><span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-2-flatmap-with-a-function">Example 2: FlatMap with a function</h3>

<p>We define a function <code class="highlighter-rouge">split_words</code> which splits an input <code class="highlighter-rouge">str</code> element using the delimiter <code class="highlighter-rouge">','</code> and outputs a <code class="highlighter-rouge">list</code> of <code class="highlighter-rouge">str</code>s.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">def</span> <span class="nf">split_words</span><span class="p">(</span><span class="n">text</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">','</span><span class="p">)</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="s">'ğŸ“Strawberry,ğŸ¥•Carrot,ğŸ†Eggplant'</span><span class="p">,</span>
          <span class="s">'ğŸ…Tomato,ğŸ¥”Potato'</span><span class="p">,</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Split words'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span><span class="n">split_words</span><span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-3-flatmap-with-a-lambda-function">Example 3: FlatMap with a lambda function</h3>

<p>For this example, we want to flatten a <code class="highlighter-rouge">PCollection</code> of lists of <code class="highlighter-rouge">str</code>s into a <code class="highlighter-rouge">PCollection</code> of <code class="highlighter-rouge">str</code>s.
Each input element is already an <code class="highlighter-rouge">iterable</code>, where each element is what we want in the resulting <code class="highlighter-rouge">PCollection</code>.
We use a lambda function that returns the same input element it received.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="p">[</span><span class="s">'ğŸ“Strawberry'</span><span class="p">,</span> <span class="s">'ğŸ¥•Carrot'</span><span class="p">,</span> <span class="s">'ğŸ†Eggplant'</span><span class="p">],</span>
          <span class="p">[</span><span class="s">'ğŸ…Tomato'</span><span class="p">,</span> <span class="s">'ğŸ¥”Potato'</span><span class="p">],</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Flatten lists'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span><span class="k">lambda</span> <span class="n">elements</span><span class="p">:</span> <span class="n">elements</span><span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-4-flatmap-with-a-generator">Example 4: FlatMap with a generator</h3>

<p>For this example, we want to flatten a <code class="highlighter-rouge">PCollection</code> of lists of <code class="highlighter-rouge">str</code>s into a <code class="highlighter-rouge">PCollection</code> of <code class="highlighter-rouge">str</code>s.
We use a generator to iterate over the input list and yield each of the elements.
Each yielded result in the generator is an element in the resulting <code class="highlighter-rouge">PCollection</code>.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">def</span> <span class="nf">generate_elements</span><span class="p">(</span><span class="n">elements</span><span class="p">):</span>
  <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">elements</span><span class="p">:</span>
    <span class="k">yield</span> <span class="n">element</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="p">[</span><span class="s">'ğŸ“Strawberry'</span><span class="p">,</span> <span class="s">'ğŸ¥•Carrot'</span><span class="p">,</span> <span class="s">'ğŸ†Eggplant'</span><span class="p">],</span>
          <span class="p">[</span><span class="s">'ğŸ…Tomato'</span><span class="p">,</span> <span class="s">'ğŸ¥”Potato'</span><span class="p">],</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Flatten lists'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span><span class="n">generate_elements</span><span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-5-flatmaptuple-for-key-value-pairs">Example 5: FlatMapTuple for key-value pairs</h3>

<p>If your <code class="highlighter-rouge">PCollection</code> consists of <code class="highlighter-rouge">(key, value)</code> pairs,
you can use <code class="highlighter-rouge">FlatMapTuple</code> to unpack them into different function arguments.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">def</span> <span class="nf">format_plant</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">plant</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">icon</span><span class="p">:</span>
    <span class="k">yield</span> <span class="s">'{}{}'</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">icon</span><span class="p">,</span> <span class="n">plant</span><span class="p">)</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="p">(</span><span class="s">'ğŸ“'</span><span class="p">,</span> <span class="s">'Strawberry'</span><span class="p">),</span>
          <span class="p">(</span><span class="s">'ğŸ¥•'</span><span class="p">,</span> <span class="s">'Carrot'</span><span class="p">),</span>
          <span class="p">(</span><span class="s">'ğŸ†'</span><span class="p">,</span> <span class="s">'Eggplant'</span><span class="p">),</span>
          <span class="p">(</span><span class="s">'ğŸ…'</span><span class="p">,</span> <span class="s">'Tomato'</span><span class="p">),</span>
          <span class="p">(</span><span class="s">'ğŸ¥”'</span><span class="p">,</span> <span class="s">'Potato'</span><span class="p">),</span>
          <span class="p">(</span><span class="bp">None</span><span class="p">,</span> <span class="s">'Invalid'</span><span class="p">),</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Format'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMapTuple</span><span class="p">(</span><span class="n">format_plant</span><span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMapTuple</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-6-flatmap-with-multiple-arguments">Example 6: FlatMap with multiple arguments</h3>

<p>You can pass functions with multiple arguments to <code class="highlighter-rouge">FlatMap</code>.
They are passed as additional positional arguments or keyword arguments to the function.</p>

<p>In this example, <code class="highlighter-rouge">split_words</code> takes <code class="highlighter-rouge">text</code> and <code class="highlighter-rouge">delimiter</code> as arguments.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">def</span> <span class="nf">split_words</span><span class="p">(</span><span class="n">text</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">)</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="s">'ğŸ“Strawberry,ğŸ¥•Carrot,ğŸ†Eggplant'</span><span class="p">,</span>
          <span class="s">'ğŸ…Tomato,ğŸ¥”Potato'</span><span class="p">,</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Split words'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span><span class="n">split_words</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s">','</span><span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-7-flatmap-with-side-inputs-as-singletons">Example 7: FlatMap with side inputs as singletons</h3>

<p>If the <code class="highlighter-rouge">PCollection</code> has a single value, such as the average from another computation,
passing the <code class="highlighter-rouge">PCollection</code> as a <em>singleton</em> accesses that value.</p>

<p>In this example, we pass a <code class="highlighter-rouge">PCollection</code> the value <code class="highlighter-rouge">','</code> as a singleton.
We then use that value as the delimiter for the <code class="highlighter-rouge">str.split</code> method.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">delimiter</span> <span class="o">=</span> <span class="n">pipeline</span> <span class="o">|</span> <span class="s">'Create delimiter'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span><span class="s">','</span><span class="p">])</span>

  <span class="n">plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="s">'ğŸ“Strawberry,ğŸ¥•Carrot,ğŸ†Eggplant'</span><span class="p">,</span>
          <span class="s">'ğŸ…Tomato,ğŸ¥”Potato'</span><span class="p">,</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Split words'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span>
          <span class="k">lambda</span> <span class="n">text</span><span class="p">,</span> <span class="n">delimiter</span><span class="p">:</span> <span class="n">text</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">delimiter</span><span class="p">),</span>
          <span class="n">delimiter</span><span class="o">=</span><span class="n">beam</span><span class="o">.</span><span class="n">pvalue</span><span class="o">.</span><span class="n">AsSingleton</span><span class="p">(</span><span class="n">delimiter</span><span class="p">),</span>
      <span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>plants = [
    'ğŸ“Strawberry',
    'ğŸ¥•Carrot',
    'ğŸ†Eggplant',
    'ğŸ…Tomato',
    'ğŸ¥”Potato',
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h3 id="example-8-flatmap-with-side-inputs-as-iterators">Example 8: FlatMap with side inputs as iterators</h3>

<p>If the <code class="highlighter-rouge">PCollection</code> has multiple values, pass the <code class="highlighter-rouge">PCollection</code> as an <em>iterator</em>.
This accesses elements lazily as they are needed,
so it is possible to iterate over large <code class="highlighter-rouge">PCollection</code>s that wonâ€™t fit into memory.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">def</span> <span class="nf">normalize_and_validate_durations</span><span class="p">(</span><span class="n">plant</span><span class="p">,</span> <span class="n">valid_durations</span><span class="p">):</span>
  <span class="n">plant</span><span class="p">[</span><span class="s">'duration'</span><span class="p">]</span> <span class="o">=</span> <span class="n">plant</span><span class="p">[</span><span class="s">'duration'</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
  <span class="k">if</span> <span class="n">plant</span><span class="p">[</span><span class="s">'duration'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">valid_durations</span><span class="p">:</span>
    <span class="k">yield</span> <span class="n">plant</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">valid_durations</span> <span class="o">=</span> <span class="n">pipeline</span> <span class="o">|</span> <span class="s">'Valid durations'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
      <span class="s">'annual'</span><span class="p">,</span>
      <span class="s">'biennial'</span><span class="p">,</span>
      <span class="s">'perennial'</span><span class="p">,</span>
  <span class="p">])</span>

  <span class="n">valid_plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ“'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Strawberry'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="s">'Perennial'</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ¥•'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Carrot'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="s">'BIENNIAL'</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ†'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Eggplant'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="s">'perennial'</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ…'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Tomato'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="s">'annual'</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ¥”'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Potato'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="s">'unknown'</span><span class="p">},</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Normalize and validate durations'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span>
          <span class="n">normalize_and_validate_durations</span><span class="p">,</span>
          <span class="n">valid_durations</span><span class="o">=</span><span class="n">beam</span><span class="o">.</span><span class="n">pvalue</span><span class="o">.</span><span class="n">AsIter</span><span class="p">(</span><span class="n">valid_durations</span><span class="p">),</span>
      <span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>valid_plants = [
    {'icon': 'ğŸ“', 'name': 'Strawberry', 'duration': 'perennial'},
    {'icon': 'ğŸ¥•', 'name': 'Carrot', 'duration': 'biennial'},
    {'icon': 'ğŸ†', 'name': 'Eggplant', 'duration': 'perennial'},
    {'icon': 'ğŸ…', 'name': 'Tomato', 'duration': 'annual'},
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<blockquote>
  <p><strong>Note</strong>: You can pass the <code class="highlighter-rouge">PCollection</code> as a <em>list</em> with <code class="highlighter-rouge">beam.pvalue.AsList(pcollection)</code>,
but this requires that all the elements fit into memory.</p>
</blockquote>

<h3 id="example-9-flatmap-with-side-inputs-as-dictionaries">Example 9: FlatMap with side inputs as dictionaries</h3>

<p>If a <code class="highlighter-rouge">PCollection</code> is small enough to fit into memory, then that <code class="highlighter-rouge">PCollection</code> can be passed as a <em>dictionary</em>.
Each element must be a <code class="highlighter-rouge">(key, value)</code> pair.
Note that all the elements of the <code class="highlighter-rouge">PCollection</code> must fit into memory for this.
If the <code class="highlighter-rouge">PCollection</code> wonâ€™t fit into memory, use <code class="highlighter-rouge">beam.pvalue.AsIter(pcollection)</code> instead.</p>

<div class="language-py highlighter-rouge"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">apache_beam</span> <span class="kn">as</span> <span class="nn">beam</span>

<span class="k">def</span> <span class="nf">replace_duration_if_valid</span><span class="p">(</span><span class="n">plant</span><span class="p">,</span> <span class="n">durations</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">plant</span><span class="p">[</span><span class="s">'duration'</span><span class="p">]</span> <span class="ow">in</span> <span class="n">durations</span><span class="p">:</span>
    <span class="n">plant</span><span class="p">[</span><span class="s">'duration'</span><span class="p">]</span> <span class="o">=</span> <span class="n">durations</span><span class="p">[</span><span class="n">plant</span><span class="p">[</span><span class="s">'duration'</span><span class="p">]]</span>
    <span class="k">yield</span> <span class="n">plant</span>

<span class="k">with</span> <span class="n">beam</span><span class="o">.</span><span class="n">Pipeline</span><span class="p">()</span> <span class="k">as</span> <span class="n">pipeline</span><span class="p">:</span>
  <span class="n">durations</span> <span class="o">=</span> <span class="n">pipeline</span> <span class="o">|</span> <span class="s">'Durations dict'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
      <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="s">'annual'</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="s">'biennial'</span><span class="p">),</span>
      <span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="s">'perennial'</span><span class="p">),</span>
  <span class="p">])</span>

  <span class="n">valid_plants</span> <span class="o">=</span> <span class="p">(</span>
      <span class="n">pipeline</span>
      <span class="o">|</span> <span class="s">'Gardening plants'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">Create</span><span class="p">([</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ“'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Strawberry'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ¥•'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Carrot'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ†'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Eggplant'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="mi">2</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ…'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Tomato'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
          <span class="p">{</span><span class="s">'icon'</span><span class="p">:</span> <span class="s">'ğŸ¥”'</span><span class="p">,</span> <span class="s">'name'</span><span class="p">:</span> <span class="s">'Potato'</span><span class="p">,</span> <span class="s">'duration'</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">},</span>
      <span class="p">])</span>
      <span class="o">|</span> <span class="s">'Replace duration if valid'</span> <span class="o">&gt;&gt;</span> <span class="n">beam</span><span class="o">.</span><span class="n">FlatMap</span><span class="p">(</span>
          <span class="n">replace_duration_if_valid</span><span class="p">,</span>
          <span class="n">durations</span><span class="o">=</span><span class="n">beam</span><span class="o">.</span><span class="n">pvalue</span><span class="o">.</span><span class="n">AsDict</span><span class="p">(</span><span class="n">durations</span><span class="p">),</span>
      <span class="p">)</span>
      <span class="o">|</span> <span class="n">beam</span><span class="o">.</span><span class="n">Map</span><span class="p">(</span><span class="k">print</span><span class="p">)</span>
  <span class="p">)</span>
</code></pre>
</div>

<p>Output <code class="highlighter-rouge">PCollection</code> after <code class="highlighter-rouge">FlatMap</code>:</p>

<div class="highlighter-rouge"><pre class="highlight"><code>valid_plants = [
    {'icon': 'ğŸ“', 'name': 'Strawberry', 'duration': 'perennial'},
    {'icon': 'ğŸ¥•', 'name': 'Carrot', 'duration': 'biennial'},
    {'icon': 'ğŸ†', 'name': 'Eggplant', 'duration': 'perennial'},
    {'icon': 'ğŸ…', 'name': 'Tomato', 'duration': 'annual'},
]
</code></pre>
</div>

<table>
  <td>
    <a class="button" target="_blank" href="https://github.com/apache/beam/blob/master/sdks/python/apache_beam/examples/snippets/transforms/element_wise/flat_map.py">
      <img src="https://www.tensorflow.org/images/GitHub-Mark-32px.png" width="20px" height="20px" alt="View on GitHub" />
      View on GitHub
    </a>
  </td>
</table>
<p><br /></p>

<h2 id="related-transforms">Related transforms</h2>

<ul>
  <li><a href="/documentation/transforms/python/elementwise/filter">Filter</a> is useful if the function is just 
deciding whether to output an element or not.</li>
  <li><a href="/documentation/transforms/python/elementwise/pardo">ParDo</a> is the most general element-wise mapping
operation, and includes other abilities such as multiple output collections and side-inputs.</li>
  <li><a href="/documentation/transforms/python/elementwise/map">Map</a> behaves the same, but produces exactly one output for each input.</li>
</ul>

<table>
  <td>
    <a class="button" target="_blank" href="https://beam.apache.org/releases/pydoc/current/apache_beam.transforms.core.html#apache_beam.transforms.core.FlatMap">
      <img src="https://beam.apache.org/images/logos/sdks/python.png" width="20px" height="20px" alt="Pydoc" />
      Pydoc
    </a>
  </td>
</table>
<p><br /></p>

      </div>
    </div>
    <!--
 Licensed under the Apache License, Version 2.0 (the "License");
 you may not use this file except in compliance with the License.
 You may obtain a copy of the License at
   http://www.apache.org/licenses/LICENSE-2.0
 Unless required by applicable law or agreed to in writing, software
 distributed under the License is distributed on an "AS IS" BASIS,
 WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 See the License for the specific language governing permissions and
 limitations under the License. See accompanying LICENSE file.
-->

<footer class="footer">
  <div class="footer__contained">
    <div class="footer__cols">
      <div class="footer__cols__col">
        <div class="footer__cols__col__logo">
          <img src="/images/beam_logo_circle.svg" class="footer__logo" alt="Beam logo">
        </div>
        <div class="footer__cols__col__logo">
          <img src="/images/apache_logo_circle.svg" class="footer__logo" alt="Apache logo">
        </div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Start</div>
        <div class="footer__cols__col__link"><a href="/get-started/beam-overview/">Overview</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-java/">Quickstart (Java)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-py/">Quickstart (Python)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-go/">Quickstart (Go)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/downloads/">Downloads</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Docs</div>
        <div class="footer__cols__col__link"><a href="/documentation/programming-guide/">Concepts</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/pipelines/design-your-pipeline/">Pipelines</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/runners/capability-matrix/">Runners</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Community</div>
        <div class="footer__cols__col__link"><a href="/contribute/">Contribute</a></div>
        <div class="footer__cols__col__link"><a href="https://projects.apache.org/committee.html?beam" target="_blank">Team<img src="/images/external-link-icon.png"
                                                                                                                                width="14" height="14"
                                                                                                                                alt="External link."></a></div>
        <div class="footer__cols__col__link"><a href="/contribute/presentation-materials/">Media</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Resources</div>
        <div class="footer__cols__col__link"><a href="/blog/">Blog</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/support/">Support</a></div>
        <div class="footer__cols__col__link"><a href="https://github.com/apache/beam">GitHub</a></div>
      </div>
    </div>
  </div>
  <div class="footer__bottom">
    &copy;
    <a href="http://www.apache.org">The Apache Software Foundation</a>
    | <a href="/privacy_policy">Privacy Policy</a>
    | <a href="/feed.xml">RSS Feed</a>
    <br><br>
    Apache Beam, Apache, Beam, the Beam logo, and the Apache feather logo are
    either registered trademarks or trademarks of The Apache Software
    Foundation. All other products or name brands are trademarks of their
    respective holders, including The Apache Software Foundation.
  </div>
</footer>

  </body>
</html>
