<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Test Your Pipeline</title>
  <meta name="description" content="Apache Beam is an open source, unified model and set of language-specific SDKs for defining and executing data processing workflows, and also data ingestion and integration flows, supporting Enterprise Integration Patterns (EIPs) and Domain Specific Languages (DSLs). Dataflow pipelines simplify the mechanics of large-scale batch and streaming data processing and can run on a number of runtimes like Apache Flink, Apache Spark, and Google Cloud Dataflow (a cloud service). Beam also brings DSL in different languages, allowing users to easily implement their data integration processes.
">
  <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400" rel="stylesheet">
  <link rel="stylesheet" href="/css/site.css">
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.0/jquery.min.js"></script>
  <script src="/js/bootstrap.min.js"></script>
  <script src="/js/language-switch.js"></script>
  <link rel="canonical" href="https://beam.apache.org/documentation/pipelines/test-your-pipeline/" data-proofer-ignore>
  <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Apache Beam" href="https://beam.apache.org/feed.xml">
  <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-73650088-1', 'auto');
    ga('send', 'pageview');
  </script>
</head>

  <body class="body ">
    <nav class="header navbar navbar-fixed-top">
    <div class="navbar-header">
      <a href="/" class="navbar-brand" >
        <img alt="Brand" style="height: 25px" src="/images/beam_logo_navbar.png">
      </a>
        <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
          <span class="sr-only">Toggle navigation</span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
          <span class="icon-bar"></span>
        </button>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Get Started <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/get-started/beam-overview/">Beam Overview</a></li>
            <li><a href="/get-started/quickstart-java/">Quickstart - Java</a></li>
            <li><a href="/get-started/quickstart-py/">Quickstart - Python</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Example Walkthroughs</li>
            <li><a href="/get-started/wordcount-example/">WordCount</a></li>
            <li><a href="/get-started/mobile-gaming-example/">Mobile Gaming</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Resources</li>
            <li><a href="/get-started/downloads">Downloads</a></li>
            <li><a href="/get-started/support">Support</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Documentation <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/documentation">Using the Documentation</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Beam Concepts</li>
            <li><a href="/documentation/programming-guide/">Programming Guide</a></li>
            <li><a href="/documentation/execution-model/">Execution Model</a></li>
            <li><a href="/documentation/resources/">Additional Resources</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Pipeline Fundamentals</li>
            <li><a href="/documentation/pipelines/design-your-pipeline/">Design Your Pipeline</a></li>
            <li><a href="/documentation/pipelines/create-your-pipeline/">Create Your Pipeline</a></li>
            <li><a href="/documentation/pipelines/test-your-pipeline/">Test Your Pipeline</a></li>
            <li><a href="/documentation/io/io-toc/">Pipeline I/O</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">SDKs</li>
            <li><a href="/documentation/sdks/java/">Java SDK</a></li>
            <li><a href="/documentation/sdks/javadoc/2.1.0/" target="_blank">Java SDK API Reference <img src="/images/external-link-icon.png"
                                                                                                                                               width="14" height="14"
                                                                                                                                                          alt="External link."></a>
            </li>
            <li><a href="/documentation/sdks/python/">Python SDK</a></li>
            <li><a href="/documentation/sdks/pydoc/2.1.0/" target="_blank">Python SDK API Reference <img src="/images/external-link-icon.png"
                                                                                                                                               width="14" height="14"
                                                                                                                                                          alt="External link."></a>
            </li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Runners</li>
            <li><a href="/documentation/runners/capability-matrix/">Capability Matrix</a></li>
            <li><a href="/documentation/runners/direct/">Direct Runner</a></li>
            <li><a href="/documentation/runners/apex/">Apache Apex Runner</a></li>
            <li><a href="/documentation/runners/flink/">Apache Flink Runner</a></li>
            <li><a href="/documentation/runners/gearpump/">Apache Gearpump Runner</a></li>
            <li><a href="/documentation/runners/spark/">Apache Spark Runner</a></li>
            <li><a href="/documentation/runners/dataflow/">Cloud Dataflow Runner</a></li>

            <li role="separator" class="divider"></li>
            <li class="dropdown-header">DSLs</li>
            <li><a href="/documentation/dsls/sql/">SQL</a></li>
          </ul>
        </li>
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Contribute <span class="caret"></span></a>
          <ul class="dropdown-menu">
            <li><a href="/contribute">Get Started Contributing</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Guides</li>
            <li><a href="/contribute/contribution-guide/">Contribution Guide</a></li>
            <li><a href="/contribute/testing/">Testing Guide</a></li>
            <li><a href="/contribute/release-guide/">Release Guide</a></li>
            <li><a href="/contribute/ptransform-style-guide/">PTransform Style Guide</a></li>
            <li><a href="/contribute/runner-guide/">Runner Authoring Guide</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Technical References</li>
            <li><a href="/contribute/design-principles/">Design Principles</a></li>
            <li><a href="/contribute/work-in-progress/">Ongoing Projects</a></li>
            <li><a href="/contribute/source-repository/">Source Repository</a></li>
            <li><a href="/contribute/docker-images/">Docker Images</a></li>
            <li role="separator" class="divider"></li>
            <li class="dropdown-header">Promotion</li>
            <li><a href="/contribute/presentation-materials/">Presentation Materials</a></li>
            <li><a href="/contribute/logos/">Logos and Design</a></li>
            <li role="separator" class="divider"></li>
            <li><a href="/contribute/maturity-model/">Maturity Model</a></li>
            <li><a href="/contribute/team/">Team</a></li>
          </ul>
        </li>

        <li><a href="/blog">Blog</a></li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false"><img src="https://www.apache.org/foundation/press/kit/feather_small.png" alt="Apache Logo" style="height:20px;"><span class="caret"></span></a>
          <ul class="dropdown-menu dropdown-menu-right">
            <li><a href="http://www.apache.org/">ASF Homepage</a></li>
            <li><a href="http://www.apache.org/licenses/">License</a></li>
            <li><a href="http://www.apache.org/security/">Security</a></li>
            <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
            <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsorship</a></li>
            <li><a href="https://www.apache.org/foundation/policies/conduct">Code of Conduct</a></li>
          </ul>
        </li>
      </ul>
    </div><!--/.nav-collapse -->
</nav>

    <div class="body__contained">
      <h1 id="test-your-pipeline">Test Your Pipeline</h1>

<ul id="markdown-toc">
  <li><a href="#testing-individual-dofn-objects" id="markdown-toc-testing-individual-dofn-objects">Testing Individual DoFn Objects</a>    <ul>
      <li><a href="#creating-a-dofntester" id="markdown-toc-creating-a-dofntester">Creating a DoFnTester</a></li>
      <li><a href="#creating-test-inputs" id="markdown-toc-creating-test-inputs">Creating Test Inputs</a>        <ul>
          <li><a href="#side-inputs" id="markdown-toc-side-inputs">Side Inputs</a></li>
          <li><a href="#additional-outputs" id="markdown-toc-additional-outputs">Additional Outputs</a></li>
        </ul>
      </li>
      <li><a href="#processing-test-inputs-and-checking-results" id="markdown-toc-processing-test-inputs-and-checking-results">Processing Test Inputs and Checking Results</a></li>
    </ul>
  </li>
  <li><a href="#testing-composite-transforms" id="markdown-toc-testing-composite-transforms">Testing Composite Transforms</a>    <ul>
      <li><a href="#testpipeline" id="markdown-toc-testpipeline">TestPipeline</a></li>
      <li><a href="#using-the-create-transform" id="markdown-toc-using-the-create-transform">Using the Create Transform</a></li>
      <li><a href="#passert" id="markdown-toc-passert">PAssert</a></li>
      <li><a href="#an-example-test-for-a-composite-transform" id="markdown-toc-an-example-test-for-a-composite-transform">An Example Test for a Composite Transform</a></li>
    </ul>
  </li>
  <li><a href="#testing-a-pipeline-end-to-end" id="markdown-toc-testing-a-pipeline-end-to-end">Testing a Pipeline End-to-End</a>    <ul>
      <li><a href="#testing-the-wordcount-pipeline" id="markdown-toc-testing-the-wordcount-pipeline">Testing the WordCount Pipeline</a></li>
    </ul>
  </li>
</ul>

<p>Testing your pipeline is a particularly important step in developing an effective data processing solution. The indirect nature of the Beam model, in which your user code constructs a pipeline graph to be executed remotely, can make debugging-failed runs a non-trivial task. Often it is faster and simpler to perform local unit testing on your pipeline code than to debug a pipeline’s remote execution.</p>

<p>Before running your pipeline on the runner of your choice, unit testing your pipeline code locally is often the best way to identify and fix bugs in your pipeline code. Unit testing your pipeline locally also allows you to use your familiar/favorite local debugging tools.</p>

<p>You can use <a href="/documentation/runners/direct">DirectRunner</a>, a local runner helpful for testing and local development.</p>

<p>After you test your pipeline using the <code class="highlighter-rouge">DirectRunner</code>, you can use the runner of your choice to test on a small scale. For example, use the Flink runner with a local or remote Flink cluster.</p>

<p>The Beam SDKs provide a number of ways to unit test your pipeline code, from the lowest to the highest levels. From the lowest to the highest level, these are:</p>

<ul>
  <li>You can test the individual function objects, such as <a href="/documentation/programming-guide/#pardo">DoFn</a>s, inside your pipeline’s core transforms.</li>
  <li>You can test an entire <a href="/documentation/programming-guide/#composite-transforms">Composite Transform</a> as a unit.</li>
  <li>You can perform an end-to-end test for an entire pipeline.</li>
</ul>

<p>To support unit testing, the Beam SDK for Java provides a number of test classes in the <a href="https://github.com/apache/beam/tree/master/sdks/java/core/src/test/java/org/apache/beam/sdk">testing package</a>. You can use these tests as references and guides.</p>

<h2 id="testing-individual-dofn-objects">Testing Individual DoFn Objects</h2>

<p>The code in your pipeline’s <code class="highlighter-rouge">DoFn</code> functions runs often, and often across multiple Compute Engine instances. Unit-testing your <code class="highlighter-rouge">DoFn</code> objects before running them using a runner service can save a great deal of debugging time and energy.</p>

<p>The Beam SDK for Java provides a convenient way to test an individual <code class="highlighter-rouge">DoFn</code> called <a href="https://github.com/apache/beam/blob/master/sdks/java/core/src/test/java/org/apache/beam/sdk/transforms/DoFnTesterTest.java">DoFnTester</a>, which is included in the SDK <code class="highlighter-rouge">Transforms</code> package.</p>

<p><code class="highlighter-rouge">DoFnTester</code>uses the <a href="http://junit.org">JUnit</a> framework. To use <code class="highlighter-rouge">DoFnTester</code>, you’ll need to do the following:</p>

<ol>
  <li>Create a <code class="highlighter-rouge">DoFnTester</code>. You’ll need to pass an instance of the <code class="highlighter-rouge">DoFn</code> you want to test to the static factory method for <code class="highlighter-rouge">DoFnTester</code>.</li>
  <li>Create one or more main test inputs of the appropriate type for your <code class="highlighter-rouge">DoFn</code>. If your <code class="highlighter-rouge">DoFn</code> takes side inputs and/or produces <a href="/documentation/programming-guide#additional-outputs">multiple outputs</a>, you should also create the side inputs and the output tags.</li>
  <li>Call <code class="highlighter-rouge">DoFnTester.processBundle</code> to process the main inputs.</li>
  <li>Use JUnit’s <code class="highlighter-rouge">Assert.assertThat</code> method to ensure the test outputs returned from <code class="highlighter-rouge">processBundle</code> match your expected values.</li>
</ol>

<h3 id="creating-a-dofntester">Creating a DoFnTester</h3>

<p>To create a <code class="highlighter-rouge">DoFnTester</code>, first create an instance of the <code class="highlighter-rouge">DoFn</code> you want to test. You then use that instance when you create a <code class="highlighter-rouge">DoFnTester</code> using the <code class="highlighter-rouge">.of()</code> static factory method:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyDoFn</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
  <span class="n">MyDoFn</span> <span class="n">myDoFn</span> <span class="o">=</span> <span class="o">...;</span>

  <span class="n">DoFnTester</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fnTester</span> <span class="o">=</span> <span class="n">DoFnTester</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">myDoFn</span><span class="o">);</span>
</code></pre>
</div>

<h3 id="creating-test-inputs">Creating Test Inputs</h3>

<p>You’ll need to create one or more test inputs for <code class="highlighter-rouge">DoFnTester</code> to send to your <code class="highlighter-rouge">DoFn</code>. To create test inputs, simply create one or more input variables of the same input type that your <code class="highlighter-rouge">DoFn</code> accepts. In the case above:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyDoFn</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="n">MyDoFn</span> <span class="n">myDoFn</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">DoFnTester</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fnTester</span> <span class="o">=</span> <span class="n">DoFnTester</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">myDoFn</span><span class="o">);</span>

<span class="n">String</span> <span class="n">testInput</span> <span class="o">=</span> <span class="s">"test1"</span><span class="o">;</span>
</code></pre>
</div>

<h4 id="side-inputs">Side Inputs</h4>

<p>If your <code class="highlighter-rouge">DoFn</code> accepts side inputs, you can create those side inputs by using the method <code class="highlighter-rouge">DoFnTester.setSideInputs</code>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyDoFn</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="n">MyDoFn</span> <span class="n">myDoFn</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">DoFnTester</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fnTester</span> <span class="o">=</span> <span class="n">DoFnTester</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">myDoFn</span><span class="o">);</span>

<span class="n">PCollectionView</span><span class="o">&lt;</span><span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;&gt;</span> <span class="n">sideInput</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">Iterable</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">value</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">fnTester</span><span class="o">.</span><span class="na">setSideInputInGlobalWindow</span><span class="o">(</span><span class="n">sideInput</span><span class="o">,</span> <span class="n">value</span><span class="o">);</span>
</code></pre>
</div>

<p>See the <code class="highlighter-rouge">ParDo</code> documentation on <a href="/documentation/programming-guide/#side-inputs">side inputs</a> for more information.</p>

<h4 id="additional-outputs">Additional Outputs</h4>

<p>If your <code class="highlighter-rouge">DoFn</code> produces multiple output <code class="highlighter-rouge">PCollection</code>s, you’ll need to set the
appropriate <code class="highlighter-rouge">TupleTag</code> objects that you’ll use to access each output. A <code class="highlighter-rouge">DoFn</code>
with multiple outputs produces a <code class="highlighter-rouge">PCollectionTuple</code> for each output; you’ll need
to provide a <code class="highlighter-rouge">TupleTagList</code> that corresponds to each output in that tuple.</p>

<p>Suppose your <code class="highlighter-rouge">DoFn</code> produces outputs of type <code class="highlighter-rouge">String</code> and <code class="highlighter-rouge">Integer</code>. You create
<code class="highlighter-rouge">TupleTag</code> objects for each, and bundle them into a <code class="highlighter-rouge">TupleTagList</code>, then set it
for the <code class="highlighter-rouge">DoFnTester</code> as follows:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyDoFn</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="n">MyDoFn</span> <span class="n">myDoFn</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">DoFnTester</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fnTester</span> <span class="o">=</span> <span class="n">DoFnTester</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">myDoFn</span><span class="o">);</span>

<span class="n">TupleTag</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">tag1</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">TupleTag</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">tag2</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">TupleTagList</span> <span class="n">tags</span> <span class="o">=</span> <span class="n">TupleTagList</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">tag1</span><span class="o">).</span><span class="na">and</span><span class="o">(</span><span class="n">tag2</span><span class="o">);</span>

<span class="n">fnTester</span><span class="o">.</span><span class="na">setOutputTags</span><span class="o">(</span><span class="n">tags</span><span class="o">);</span>
</code></pre>
</div>

<p>See the <code class="highlighter-rouge">ParDo</code> documentation on <a href="/documentation/programming-guide/#additional-outputs">additional outputs</a> for more information.</p>

<h3 id="processing-test-inputs-and-checking-results">Processing Test Inputs and Checking Results</h3>

<p>To process the inputs (and thus run the test on your <code class="highlighter-rouge">DoFn</code>), you call the method <code class="highlighter-rouge">DoFnTester.processBundle</code>. When you call <code class="highlighter-rouge">processBundle</code>, you pass one or more main test input values for your <code class="highlighter-rouge">DoFn</code>. If you set side inputs, the side inputs are available to each batch of main inputs that you provide.</p>

<p><code class="highlighter-rouge">DoFnTester.processBundle</code> returns a <code class="highlighter-rouge">List</code> of outputs—that is, objects of the same type as the <code class="highlighter-rouge">DoFn</code>’s specified output type. For a <code class="highlighter-rouge">DoFn&lt;String, Integer&gt;</code>, <code class="highlighter-rouge">processBundle</code> returns a <code class="highlighter-rouge">List&lt;Integer&gt;</code>:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">static</span> <span class="kd">class</span> <span class="nc">MyDoFn</span> <span class="kd">extends</span> <span class="n">DoFn</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="o">{</span> <span class="o">...</span> <span class="o">}</span>
<span class="n">MyDoFn</span> <span class="n">myDoFn</span> <span class="o">=</span> <span class="o">...;</span>
<span class="n">DoFnTester</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Integer</span><span class="o">&gt;</span> <span class="n">fnTester</span> <span class="o">=</span> <span class="n">DoFnTester</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">myDoFn</span><span class="o">);</span>

<span class="n">String</span> <span class="n">testInput</span> <span class="o">=</span> <span class="s">"test1"</span><span class="o">;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">testOutputs</span> <span class="o">=</span> <span class="n">fnTester</span><span class="o">.</span><span class="na">processBundle</span><span class="o">(</span><span class="n">testInput</span><span class="o">);</span>
</code></pre>
</div>

<p>To check the results of <code class="highlighter-rouge">processBundle</code>, you use JUnit’s <code class="highlighter-rouge">Assert.assertThat</code> method to test if the <code class="highlighter-rouge">List</code> of outputs contains the values you expect:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">testInput</span> <span class="o">=</span> <span class="s">"test1"</span><span class="o">;</span>
<span class="n">List</span><span class="o">&lt;</span><span class="n">Integer</span><span class="o">&gt;</span> <span class="n">testOutputs</span> <span class="o">=</span> <span class="n">fnTester</span><span class="o">.</span><span class="na">processBundle</span><span class="o">(</span><span class="n">testInput</span><span class="o">);</span>

<span class="n">Assert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">testOutputs</span><span class="o">,</span> <span class="n">Matchers</span><span class="o">.</span><span class="na">hasItems</span><span class="o">(...));</span>

<span class="c1">// Process a larger batch in a single step.</span>
<span class="n">Assert</span><span class="o">.</span><span class="na">assertThat</span><span class="o">(</span><span class="n">fnTester</span><span class="o">.</span><span class="na">processBundle</span><span class="o">(</span><span class="s">"input1"</span><span class="o">,</span> <span class="s">"input2"</span><span class="o">,</span> <span class="s">"input3"</span><span class="o">),</span> <span class="n">Matchers</span><span class="o">.</span><span class="na">hasItems</span><span class="o">(...));</span>
</code></pre>
</div>

<h2 id="testing-composite-transforms">Testing Composite Transforms</h2>

<p>To test a composite transform you’ve created, you can use the following pattern:</p>

<ul>
  <li>Create a <code class="highlighter-rouge">TestPipeline</code>.</li>
  <li>Create some static, known test input data.</li>
  <li>Use the <code class="highlighter-rouge">Create</code> transform to create a <code class="highlighter-rouge">PCollection</code> of your input data.</li>
  <li><code class="highlighter-rouge">Apply</code> your composite transform to the input <code class="highlighter-rouge">PCollection</code> and save the resulting output <code class="highlighter-rouge">PCollection</code>.</li>
  <li>Use <code class="highlighter-rouge">PAssert</code> and its subclasses to verify that the output <code class="highlighter-rouge">PCollection</code> contains the elements that you expect.</li>
</ul>

<h3 id="testpipeline">TestPipeline</h3>

<p><a href="https://github.com/apache/beam/blob/master/sdks/java/core/src/main/java/org/apache/beam/sdk/testing/TestPipeline.java">TestPipeline</a> is a class included in the Beam Java SDK specifically for testing transforms. For tests, use <code class="highlighter-rouge">TestPipeline</code> in place of <code class="highlighter-rouge">Pipeline</code> when you create the pipeline object. Unlike <code class="highlighter-rouge">Pipeline.create</code>, <code class="highlighter-rouge">TestPipeline.create</code> handles setting <code class="highlighter-rouge">PipelineOptions</code> interally.</p>

<p>You create a <code class="highlighter-rouge">TestPipeline</code> as follows:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Pipeline</span> <span class="n">p</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
</code></pre>
</div>

<blockquote>
  <p><strong>Note:</strong> Read about testing unbounded pipelines in Beam in <a href="/blog/2016/10/20/test-stream.html">this blog post</a>.</p>
</blockquote>

<h3 id="using-the-create-transform">Using the Create Transform</h3>

<p>You can use the <code class="highlighter-rouge">Create</code> transform to create a <code class="highlighter-rouge">PCollection</code> out of a standard in-memory collection class, such as Java <code class="highlighter-rouge">List</code>. See <a href="/documentation/programming-guide/#creating-a-pcollection">Creating a PCollection</a> for more information.</p>

<h3 id="passert">PAssert</h3>
<p><a href="/documentation/sdks/javadoc/2.1.0/index.html?org/apache/beam/sdk/testing/PAssert.html">PAssert</a> is a class included in the Beam Java SDK  that is an assertion on the contents of a <code class="highlighter-rouge">PCollection</code>. You can use <code class="highlighter-rouge">PAssert</code>to verify that a <code class="highlighter-rouge">PCollection</code> contains a specific set of expected elements.</p>

<p>For a given <code class="highlighter-rouge">PCollection</code>, you can use <code class="highlighter-rouge">PAssert</code> to verify the contents as follows:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="o">...;</span>

<span class="c1">// Check whether a PCollection contains some elements in any order.</span>
<span class="n">PAssert</span><span class="o">.</span><span class="na">that</span><span class="o">(</span><span class="n">output</span><span class="o">)</span>
<span class="o">.</span><span class="na">containsInAnyOrder</span><span class="o">(</span>
  <span class="s">"elem1"</span><span class="o">,</span>
  <span class="s">"elem3"</span><span class="o">,</span>
  <span class="s">"elem2"</span><span class="o">);</span>
</code></pre>
</div>

<p>Any code that uses <code class="highlighter-rouge">PAssert</code> must link in <code class="highlighter-rouge">JUnit</code> and <code class="highlighter-rouge">Hamcrest</code>. If you’re using Maven, you can link in <code class="highlighter-rouge">Hamcrest</code> by adding the following dependency to your project’s <code class="highlighter-rouge">pom.xml</code> file:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="o">&lt;</span><span class="n">dependency</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">groupId</span><span class="o">&gt;</span><span class="n">org</span><span class="o">.</span><span class="na">hamcrest</span><span class="o">&lt;/</span><span class="n">groupId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">artifactId</span><span class="o">&gt;</span><span class="n">hamcrest</span><span class="o">-</span><span class="n">all</span><span class="o">&lt;/</span><span class="n">artifactId</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">version</span><span class="o">&gt;</span><span class="mf">1.3</span><span class="o">&lt;/</span><span class="n">version</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">scope</span><span class="o">&gt;</span><span class="n">test</span><span class="o">&lt;/</span><span class="n">scope</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">dependency</span><span class="o">&gt;</span>
</code></pre>
</div>

<p>For more information on how these classes work, see the <a href="/documentation/sdks/javadoc/2.1.0/index.html?org/apache/beam/sdk/testing/package-summary.html">org.apache.beam.sdk.testing</a> package documentation.</p>

<h3 id="an-example-test-for-a-composite-transform">An Example Test for a Composite Transform</h3>

<p>The following code shows a complete test for a composite transform. The test applies the <code class="highlighter-rouge">Count</code> transform to an input <code class="highlighter-rouge">PCollection</code> of <code class="highlighter-rouge">String</code> elements. The test uses the <code class="highlighter-rouge">Create</code> transform to create the input <code class="highlighter-rouge">PCollection</code> from a Java <code class="highlighter-rouge">List&lt;String&gt;</code>.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CountTest</span> <span class="o">{</span>

<span class="c1">// Our static input data, which will make up the initial PCollection.</span>
<span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">WORDS_ARRAY</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span>
<span class="s">"hi"</span><span class="o">,</span> <span class="s">"there"</span><span class="o">,</span> <span class="s">"hi"</span><span class="o">,</span> <span class="s">"hi"</span><span class="o">,</span> <span class="s">"sue"</span><span class="o">,</span> <span class="s">"bob"</span><span class="o">,</span>
<span class="s">"hi"</span><span class="o">,</span> <span class="s">"sue"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"ZOW"</span><span class="o">,</span> <span class="s">"bob"</span><span class="o">,</span> <span class="s">""</span><span class="o">};</span>

<span class="kd">static</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">WORDS</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">WORDS_ARRAY</span><span class="o">);</span>

<span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCount</span><span class="o">()</span> <span class="o">{</span>
  <span class="c1">// Create a test pipeline.</span>
  <span class="n">Pipeline</span> <span class="n">p</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

  <span class="c1">// Create an input PCollection.</span>
  <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">Create</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">WORDS</span><span class="o">)).</span><span class="na">setCoder</span><span class="o">(</span><span class="n">StringUtf8Coder</span><span class="o">.</span><span class="na">of</span><span class="o">());</span>

  <span class="c1">// Apply the Count transform under test.</span>
  <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">KV</span><span class="o">&lt;</span><span class="n">String</span><span class="o">,</span> <span class="n">Long</span><span class="o">&gt;&gt;</span> <span class="n">output</span> <span class="o">=</span>
    <span class="n">input</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">Count</span><span class="o">.&lt;</span><span class="n">String</span><span class="o">&gt;</span><span class="n">perElement</span><span class="o">());</span>

  <span class="c1">// Assert on the results.</span>
  <span class="n">PAssert</span><span class="o">.</span><span class="na">that</span><span class="o">(</span><span class="n">output</span><span class="o">)</span>
    <span class="o">.</span><span class="na">containsInAnyOrder</span><span class="o">(</span>
        <span class="n">KV</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"hi"</span><span class="o">,</span> <span class="mi">4L</span><span class="o">),</span>
        <span class="n">KV</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"there"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">),</span>
        <span class="n">KV</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"sue"</span><span class="o">,</span> <span class="mi">2L</span><span class="o">),</span>
        <span class="n">KV</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"bob"</span><span class="o">,</span> <span class="mi">2L</span><span class="o">),</span>
        <span class="n">KV</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">""</span><span class="o">,</span> <span class="mi">3L</span><span class="o">),</span>
        <span class="n">KV</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="s">"ZOW"</span><span class="o">,</span> <span class="mi">1L</span><span class="o">));</span>

  <span class="c1">// Run the pipeline.</span>
  <span class="n">p</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
<span class="o">}</span>
</code></pre>
</div>

<h2 id="testing-a-pipeline-end-to-end">Testing a Pipeline End-to-End</h2>

<p>You can use the test classes in the Beam SDKs (such as <code class="highlighter-rouge">TestPipeline</code> and <code class="highlighter-rouge">PAssert</code> in the Beam SDK for Java) to test an entire pipeline end-to-end. Typically, to test an entire pipeline, you do the following:</p>

<ul>
  <li>For every source of input data to your pipeline, create some known static test input data.</li>
  <li>Create some static test output data that matches what you expect in your pipeline’s final output <code class="highlighter-rouge">PCollection</code>(s).</li>
  <li>Create a <code class="highlighter-rouge">TestPipeline</code> in place of the standard <code class="highlighter-rouge">Pipeline.create</code>.</li>
  <li>In place of your pipeline’s <code class="highlighter-rouge">Read</code> transform(s), use the <code class="highlighter-rouge">Create</code> transform to create one or more <code class="highlighter-rouge">PCollection</code>s from your static input data.</li>
  <li>Apply your pipeline’s transforms.</li>
  <li>In place of your pipeline’s <code class="highlighter-rouge">Write</code> transform(s), use <code class="highlighter-rouge">PAssert</code> to verify that the contents of the final <code class="highlighter-rouge">PCollection</code>s your pipeline produces match the expected values in your static output data.</li>
</ul>

<h3 id="testing-the-wordcount-pipeline">Testing the WordCount Pipeline</h3>

<p>The following example code shows how one might test the <a href="/get-started/wordcount-example/">WordCount example pipeline</a>. <code class="highlighter-rouge">WordCount</code> usually reads lines from a text file for input data; instead, the test creates a Java <code class="highlighter-rouge">List&lt;String&gt;</code> containing some text lines and uses a <code class="highlighter-rouge">Create</code> transform to create an initial <code class="highlighter-rouge">PCollection</code>.</p>

<p><code class="highlighter-rouge">WordCount</code>’s final transform (from the composite transform <code class="highlighter-rouge">CountWords</code>) produces a <code class="highlighter-rouge">PCollection&lt;String&gt;</code> of formatted word counts suitable for printing. Rather than write that <code class="highlighter-rouge">PCollection</code> to an output text file, our test pipeline uses <code class="highlighter-rouge">PAssert</code> to verify that the elements of the <code class="highlighter-rouge">PCollection</code> match those of a static <code class="highlighter-rouge">String</code> array containing our expected output data.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">WordCountTest</span> <span class="o">{</span>

    <span class="c1">// Our static input data, which will comprise the initial PCollection.</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">WORDS_ARRAY</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span>
      <span class="s">"hi there"</span><span class="o">,</span> <span class="s">"hi"</span><span class="o">,</span> <span class="s">"hi sue bob"</span><span class="o">,</span>
      <span class="s">"hi sue"</span><span class="o">,</span> <span class="s">""</span><span class="o">,</span> <span class="s">"bob hi"</span><span class="o">};</span>

    <span class="kd">static</span> <span class="kd">final</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">WORDS</span> <span class="o">=</span> <span class="n">Arrays</span><span class="o">.</span><span class="na">asList</span><span class="o">(</span><span class="n">WORDS_ARRAY</span><span class="o">);</span>

    <span class="c1">// Our static output data, which is the expected data that the final PCollection must match.</span>
    <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span><span class="o">[]</span> <span class="n">COUNTS_ARRAY</span> <span class="o">=</span> <span class="k">new</span> <span class="n">String</span><span class="o">[]</span> <span class="o">{</span>
        <span class="s">"hi: 5"</span><span class="o">,</span> <span class="s">"there: 1"</span><span class="o">,</span> <span class="s">"sue: 2"</span><span class="o">,</span> <span class="s">"bob: 2"</span><span class="o">};</span>

    <span class="c1">// Example test that tests the pipeline's transforms.</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">testCountWords</span><span class="o">()</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
      <span class="n">Pipeline</span> <span class="n">p</span> <span class="o">=</span> <span class="n">TestPipeline</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>

      <span class="c1">// Create a PCollection from the WORDS static input data.</span>
      <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">input</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="n">Create</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">WORDS</span><span class="o">)).</span><span class="na">setCoder</span><span class="o">(</span><span class="n">StringUtf8Coder</span><span class="o">.</span><span class="na">of</span><span class="o">());</span>

      <span class="c1">// Run ALL the pipeline's transforms (in this case, the CountWords composite transform).</span>
      <span class="n">PCollection</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">output</span> <span class="o">=</span> <span class="n">input</span><span class="o">.</span><span class="na">apply</span><span class="o">(</span><span class="k">new</span> <span class="n">CountWords</span><span class="o">());</span>

      <span class="c1">// Assert that the output PCollection matches the COUNTS_ARRAY known static output data.</span>
      <span class="n">PAssert</span><span class="o">.</span><span class="na">that</span><span class="o">(</span><span class="n">output</span><span class="o">).</span><span class="na">containsInAnyOrder</span><span class="o">(</span><span class="n">COUNTS_ARRAY</span><span class="o">);</span>

      <span class="c1">// Run the pipeline.</span>
      <span class="n">p</span><span class="o">.</span><span class="na">run</span><span class="o">();</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre>
</div>

    </div>
    <footer class="footer">
  <div class="footer__contained">
    <div class="footer__cols">
      <div class="footer__cols__col">
        <div class="footer__cols__col__logo">
          <img src="/images/beam_logo_circle.svg" class="footer__logo" alt="Beam logo">
        </div>
        <div class="footer__cols__col__logo">
          <img src="/images/apache_logo_circle.svg" class="footer__logo" alt="Apache logo">
        </div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Start</div>
        <div class="footer__cols__col__link"><a href="/get-started/beam-overview/">Overview</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-java/">Quickstart (Java)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/quickstart-py/">Quickstart (Python)</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/downloads/">Downloads</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Docs</div>
        <div class="footer__cols__col__link"><a href="/documentation/programming-guide/">Concepts</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/pipelines/design-your-pipeline/">Pipelines</a></div>
        <div class="footer__cols__col__link"><a href="/documentation/runners/capability-matrix/">Runners</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Community</div>
        <div class="footer__cols__col__link"><a href="/contribute/">Contribute</a></div>
        <div class="footer__cols__col__link"><a href="/contribute/team/">Team</a></div>
        <div class="footer__cols__col__link"><a href="/contribute/presentation-materials/">Media</a></div>
      </div>
      <div class="footer__cols__col footer__cols__col--md">
        <div class="footer__cols__col__title">Resources</div>
        <div class="footer__cols__col__link"><a href="/blog/">Blog</a></div>
        <div class="footer__cols__col__link"><a href="/get-started/support/">Support</a></div>
        <div class="footer__cols__col__link"><a href="https://github.com/apache/beam">GitHub</a></div>
      </div>
    </div>
  </div>
  <div class="footer__bottom">
    &copy;
    <a href="http://www.apache.org">The Apache Software Foundation</a>
    | <a href="/privacy_policy">Privacy Policy</a>
    | <a href="/feed.xml">RSS Feed</a>
    <br><br>
    Apache Beam, Apache, Beam, the Beam logo, and the Apache feather logo are
    either registered trademarks or trademarks of The Apache Software
    Foundation. All other products or name brands are trademarks of their
    respective holders, including The Apache Software Foundation.
  </div>
</footer>

  </body>
</html>
